"use strict";(self.webpackChunkfundacion_todo_por_un_alma=self.webpackChunkfundacion_todo_por_un_alma||[]).push([[101],{2101:(e,a,r)=>{r.r(a),r.d(a,{default:()=>b});var t=r(5043),n=r(3474),i=r(4349),o=r(7522),l=r(3324),d=r(2144),s=r(1379),c=r(3714),u=r(6938),p=r(579);const m=()=>{const[e,a]=(0,t.useState)([]),[r,m]=(0,t.useState)([]),[b,h]=(0,t.useState)(!0),[f,x]=(0,t.useState)(null),{filters:g,setFilter:y,clearFilters:v}=(0,c.R7)({participante:"Todos",busqueda:""}),A=(0,c.hS)(),N=(0,c.hS)(),j=(0,c.hS)(),w=(0,t.useCallback)(async()=>{try{h(!0),x(null),console.log("\ud83d\udd04 Cargando acudientes...");const e=await i.C5.getAcudientes();if(console.log("\ud83d\udcca Resultado acudientes:",e),e.error)throw new Error(e.error.message||"Error al cargar acudientes");const r=Array.isArray(e.data)?e.data:[];a(r),console.log("\u2705 Acudientes cargados:",r.length)}catch(e){console.error("\u274c Error cargando acudientes:",e),x(e.message||"Error desconocido al cargar acudientes"),a([])}finally{h(!1)}},[]),E=(0,t.useCallback)(async()=>{try{console.log("\ud83d\udd04 Cargando participantes...");const e=await i.C5.getParticipantes();if(e.error)return console.error("Error cargando participantes:",e.error),void m([]);const a=Array.isArray(e.data)?e.data:[];m(a),console.log("\u2705 Participantes cargados:",a.length)}catch(e){console.error("\u274c Error cargando participantes:",e),m([])}},[]);(0,t.useEffect)(()=>{w(),E()},[w,E]);const C=(0,t.useMemo)(()=>{let a=Array.isArray(e)?e:[];return"Todos"!==g.participante&&(a=a.filter(e=>{var a;const r=e.id_participante||(null===(a=e.participante)||void 0===a?void 0:a.id_participante);return r&&r.toString()===g.participante})),g.busqueda&&(a=a.filter(e=>(e.numero_documento||"").includes(g.busqueda))),a},[e,g]),_=(0,t.useMemo)(()=>[{title:"Total Acudientes",value:C.length,icon:"fas fa-user-friends",color:"blue"}],[C]),V=(0,t.useCallback)(()=>{const e=window.open("","_blank"),a=(new Date).toLocaleDateString("es-ES"),t="\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Lista de Acudientes - ".concat(a,'</title>\n          <style>\n            body {\n              font-family: Arial, sans-serif;\n              margin: 20px;\n              color: #333;\n            }\n            .header {\n              text-align: center;\n              margin-bottom: 30px;\n              border-bottom: 2px solid #333;\n              padding-bottom: 20px;\n            }\n            .header h1 {\n              color: #7c3aed;\n              margin: 0;\n              font-size: 24px;\n            }\n            .filters {\n              margin-bottom: 20px;\n              background: #f8f9fa;\n              padding: 15px;\n              border-radius: 5px;\n            }\n            .filters h3 {\n              margin: 0 0 10px 0;\n              color: #495057;\n            }\n            .filters p {\n              margin: 5px 0;\n              font-size: 14px;\n            }\n            table {\n              width: 100%;\n              border-collapse: collapse;\n              margin-top: 20px;\n            }\n            th, td {\n              border: 1px solid #ddd;\n              padding: 8px 12px;\n              text-align: left;\n            }\n            th {\n              background-color: #f8f9fa;\n              font-weight: bold;\n              color: #495057;\n            }\n            tr:nth-child(even) {\n              background-color: #f9f9f9;\n            }\n            .stats {\n              margin-top: 30px;\n              background: #ede9fe;\n              padding: 15px;\n              border-radius: 5px;\n            }\n            .stats h3 {\n              margin: 0 0 10px 0;\n              color: #7c3aed;\n            }\n            .stats p {\n              margin: 5px 0;\n              font-size: 14px;\n            }\n            @media print {\n              body { margin: 0; }\n              .no-print { display: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <h1>Lista de Acudientes</h1>\n            <p>Corporaci\xf3n Todo por un Alma</p>\n            <p>Fecha de generaci\xf3n: ').concat(a,'</p>\n          </div>\n\n          <div class="filters">\n            <h3>Filtros aplicados:</h3>\n            <p><strong>Participante:</strong> ').concat("Todos"===g.participante?"Todos los participantes":(()=>{const e=r.find(e=>(e.id_participante||e.id).toString()===g.participante);return(null===e||void 0===e?void 0:e.nombre)||"".concat((null===e||void 0===e?void 0:e.nombres)||""," ").concat((null===e||void 0===e?void 0:e.apellidos)||"").trim()||"N/A"})(),"</p>\n            ").concat(g.busqueda?'<p><strong>B\xfasqueda:</strong> "'.concat(g.busqueda,'"</p>'):"","\n          </div>\n\n          <table>\n            <thead>\n              <tr>\n                <th>Acudiente</th>\n                <th>Documento</th>\n                <th>Participante</th>\n                <th>Parentesco</th>\n                <th>Tel\xe9fono</th>\n                <th>Email</th>\n              </tr>\n            </thead>\n            <tbody>\n              ").concat(C.map(e=>{const a=r.find(a=>(a.id_participante||a.id)===e.id_participante);return"\n                  <tr>\n                    <td>".concat("".concat(e.nombres||""," ").concat(e.apellidos||"").trim()||"N/A","</td>\n                    <td>").concat(e.tipo_documento||"CC",": ").concat(e.numero_documento||"N/A","</td>\n                    <td>").concat((null===a||void 0===a?void 0:a.nombre)||"".concat((null===a||void 0===a?void 0:a.nombres)||""," ").concat((null===a||void 0===a?void 0:a.apellidos)||"").trim()||"N/A","</td>\n                    <td>").concat(e.parentesco||"N/A","</td>\n                    <td>").concat(e.telefono||"N/A","</td>\n                    <td>").concat(e.email||"N/A","</td>\n                  </tr>\n                ")}).join(""),'\n            </tbody>\n          </table>\n\n          <div class="stats">\n            <h3>Estad\xedsticas:</h3>\n            <p><strong>Total de acudientes:</strong> ').concat(C.length,"</p>\n          </div>\n\n          <script>\n            window.onload = function() {\n              window.print();\n              setTimeout(function() {\n                window.close();\n              }, 1000);\n            }\n          <\/script>\n        </body>\n      </html>\n    ");e.document.write(t),e.document.close()},[g,C,r]);if(b)return(0,p.jsx)(n.A,{title:"Acudientes",subtitle:"Gesti\xf3n de acudientes",loading:!0,loadingText:"Cargando acudientes..."});if(f)return(0,p.jsx)(n.A,{title:"Acudientes",subtitle:"Error al cargar datos",loading:!1,children:(0,p.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,p.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,p.jsxs)("p",{className:"text-red-600",children:["Error loading acudientes: ",f]})})})});const D=[{type:"select",name:"participante",label:"Participante",options:[{value:"Todos",label:"Todos los Participantes"},...r.map(e=>({value:(e.id_participante||e.id).toString(),label:e.nombre||"".concat(e.nombres," ").concat(e.apellidos)||"Sin nombre"}))]},{type:"search",name:"busqueda",label:"B\xfasqueda por Documento",placeholder:"N\xfamero de documento..."}];return(0,p.jsxs)(n.A,{title:"Gesti\xf3n de Acudientes",subtitle:"Administra los acudientes de los participantes",extraActions:(0,p.jsxs)("div",{className:"flex space-x-3",children:[(0,p.jsxs)("button",{onClick:V,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",title:"Exportar lista filtrada a PDF",children:[(0,p.jsx)("i",{className:"fas fa-file-pdf mr-2"}),"Exportar PDF"]}),(0,p.jsxs)("button",{onClick:()=>j.openModal(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,p.jsx)("i",{className:"fas fa-plus mr-2"}),"Nuevo Acudiente"]})]}),children:[(0,p.jsxs)("section",{className:"px-6 py-6",children:[(0,p.jsx)(o.Qn,{filters:D,values:g,onChange:y,onClear:v,showClearButton:!0}),(0,p.jsx)("div",{className:"mt-6",children:(0,p.jsx)(l.MD,{stats:_,columns:3,gap:"md"})}),(0,p.jsx)("div",{className:"mt-6",children:(0,p.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,p.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Lista de Acudientes"})}),0===C.length?(0,p.jsxs)("div",{className:"p-12 text-center",children:[(0,p.jsx)("i",{className:"fas fa-user-friends text-gray-300 text-4xl mb-4"}),(0,p.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron acudientes"}),(0,p.jsx)("p",{className:"text-gray-500",children:"No hay acudientes que coincidan con los filtros aplicados."})]}):(0,p.jsx)(d.bQ,{keyExtractor:e=>e.id_acudiente||e.id,columns:[{key:"acudiente",header:"Acudiente",render:e=>(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3",children:(0,p.jsx)("i",{className:"fas fa-user-friends text-purple-600"})}),(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"font-medium text-gray-900",children:"".concat(e.nombres||""," ").concat(e.apellidos||"").trim()||"Sin nombre"}),(0,p.jsxs)("p",{className:"text-sm text-gray-500",children:[e.tipo_documento||"CC",": ",e.numero_documento||"N/A"]})]})]})},{key:"participante",header:"Participante",render:e=>{const a=r.find(a=>(a.id_participante||a.id)===e.id_participante);return(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"text-gray-900",children:(null===a||void 0===a?void 0:a.nombre)||"".concat((null===a||void 0===a?void 0:a.nombres)||""," ").concat((null===a||void 0===a?void 0:a.apellidos)||"").trim()||"N/A"}),(0,p.jsx)("p",{className:"text-sm text-gray-500",children:e.parentesco||"Sin parentesco"})]})}},{key:"contacto",header:"Contacto",render:e=>(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{className:"text-gray-900",children:[(0,p.jsx)("i",{className:"fas fa-phone text-gray-400 mr-2"}),e.telefono||"N/A"]}),(0,p.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,p.jsx)("i",{className:"fas fa-envelope text-gray-400 mr-2"}),e.email||"N/A"]})]})},{key:"acciones",header:"Acciones",render:e=>(0,p.jsx)(d.yd,{actions:[{label:"Ver detalles",icon:"fas fa-eye",onClick:()=>{A.setData(e),A.open()}},{label:"Editar",icon:"fas fa-edit",onClick:()=>{N.setData(e),N.open()}}]})}],data:C})]})})]}),(0,p.jsx)(s.J$,{isOpen:A.isOpen,onClose:A.closeModal,title:"Detalles del Acudiente",data:A.data?[{label:"ID",value:A.data.id_acudiente||A.data.id},{label:"Nombre Completo",value:"".concat(A.data.nombres||""," ").concat(A.data.apellidos||"").trim()},{label:"Documento",value:"".concat(A.data.tipo_documento||"CC",": ").concat(A.data.numero_documento||"N/A")},{label:"Parentesco",value:A.data.parentesco||"N/A"},{label:"Tel\xe9fono",value:A.data.telefono||"N/A"},{label:"Email",value:A.data.email||"N/A"},{label:"Direcci\xf3n",value:A.data.direccion||"N/A"},{label:"Participante",value:(()=>{const e=r.find(e=>(e.id_participante||e.id)===A.data.id_participante);return(null===e||void 0===e?void 0:e.nombre)||"".concat((null===e||void 0===e?void 0:e.nombres)||""," ").concat((null===e||void 0===e?void 0:e.apellidos)||"").trim()||"N/A"})()}]:[]}),(0,p.jsx)(s.M9,{isOpen:N.isOpen,onClose:N.closeModal,title:"Editar Acudiente",onSubmit:async e=>{const a=N.data.id_acudiente||N.data.id,r=await(0,u.BZ)(e.numero_documento,a);if(!r.isValid)throw new Error(r.error);const t=(0,u.DT)(e.email);if(!t.isValid)throw new Error(t.error);const n=await i.C5.updateAcudiente(N.data.id_acudiente||N.data.id,e);if(n.error)throw new Error(n.error.message||"Error al actualizar acudiente");await w()},initialData:N.data,fields:[{name:"tipo_documento",label:"Tipo de Documento",type:"select",required:!0,options:[{value:"CC",label:"C\xe9dula de Ciudadan\xeda"},{value:"TI",label:"Tarjeta de Identidad"},{value:"CE",label:"C\xe9dula de Extranjer\xeda"},{value:"PASAPORTE",label:"Pasaporte"}]},{name:"numero_documento",label:"N\xfamero de Documento",type:"text",required:!0,placeholder:"N\xfamero de documento"},{name:"nombres",label:"Nombres",type:"text",required:!0,placeholder:"Nombres del acudiente"},{name:"apellidos",label:"Apellidos",type:"text",required:!0,placeholder:"Apellidos del acudiente"},{name:"parentesco",label:"Parentesco",type:"text",required:!0,placeholder:"Ej: Madre, Padre, Hermano/a"},{name:"telefono",label:"Tel\xe9fono",type:"tel",required:!0,placeholder:"N\xfamero de tel\xe9fono"},{name:"email",label:"Email",type:"email",required:!0,placeholder:"correo@ejemplo.com"},{name:"direccion",label:"Direcci\xf3n",type:"textarea",required:!0,placeholder:"Direcci\xf3n completa"}]}),(0,p.jsx)(s.s5,{isOpen:j.isOpen,onClose:j.closeModal,title:"Nuevo Acudiente",onSubmit:async e=>{const a=await(0,u.BZ)(e.numero_documento);if(!a.isValid)throw new Error(a.error);const r=(0,u.DT)(e.email);if(!r.isValid)throw new Error(r.error);const t=await(0,u.ju)(e.id_participante);if(!t.isValid)throw new Error(t.error);const n=await i.C5.createAcudiente(e);if(n.error)throw new Error(n.error.message||"Error al crear acudiente");await w()},initialData:{id_participante:"",tipo_documento:"CC",numero_documento:"",nombres:"",apellidos:"",parentesco:"",telefono:"",email:"",direccion:""},fields:[{name:"id_participante",label:"Participante",type:"select",required:!0,options:[{value:"",label:"Seleccione un participante"},...r.map(e=>({value:(e.id_participante||e.id).toString(),label:e.nombre||"".concat(e.nombres||""," ").concat(e.apellidos||"").trim()||"Sin nombre"}))]},{name:"tipo_documento",label:"Tipo de Documento",type:"select",required:!0,options:[{value:"CC",label:"C\xe9dula de Ciudadan\xeda"},{value:"TI",label:"Tarjeta de Identidad"},{value:"CE",label:"C\xe9dula de Extranjer\xeda"},{value:"PASAPORTE",label:"Pasaporte"}]},{name:"numero_documento",label:"N\xfamero de Documento",type:"text",required:!0,placeholder:"N\xfamero de documento"},{name:"nombres",label:"Nombres",type:"text",required:!0,placeholder:"Nombres del acudiente"},{name:"apellidos",label:"Apellidos",type:"text",required:!0,placeholder:"Apellidos del acudiente"},{name:"parentesco",label:"Parentesco",type:"text",required:!0,placeholder:"Ej: Madre, Padre, Hermano/a"},{name:"telefono",label:"Tel\xe9fono",type:"tel",required:!0,placeholder:"N\xfamero de tel\xe9fono"},{name:"email",label:"Email",type:"email",required:!0,placeholder:"correo@ejemplo.com"},{name:"direccion",label:"Direcci\xf3n",type:"textarea",required:!0,placeholder:"Direcci\xf3n completa"}]})]})},b=t.memo(m)},6938:(e,a,r)=>{r.d(a,{BZ:()=>i,DT:()=>o,F2:()=>p,Hc:()=>s,Ri:()=>n,Wk:()=>u,Zi:()=>d,ju:()=>c});var t=r(4349);const n=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!e||!e.trim())return{isValid:!1,error:"El n\xfamero de documento es requerido"};const r=await t.C5.getParticipantes();if(r.data&&Array.isArray(r.data)){if(r.data.some(r=>{const t=r.id||r.id_participante;return r.numero_documento===e&&t!==a}))return{isValid:!1,error:"El n\xfamero de documento ya est\xe1 registrado para otro participante"}}return{isValid:!0,error:null}}catch(r){return console.error("Error validating participante documento:",r),{isValid:!0,error:null}}},i=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!e||!e.trim())return{isValid:!1,error:"El n\xfamero de documento es requerido"};const r=await t.C5.getAcudientes();if(r.data&&Array.isArray(r.data)){if(r.data.some(r=>{const t=r.id||r.id_acudiente;return r.numero_documento===e&&t!==a}))return{isValid:!1,error:"El n\xfamero de documento ya est\xe1 registrado para otro acudiente"}}return{isValid:!0,error:null}}catch(r){return console.error("Error validating acudiente documento:",r),{isValid:!0,error:null}}},o=e=>{if(!e||!e.trim())return{isValid:!1,error:"El email es requerido"};return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?{isValid:!0,error:null}:{isValid:!1,error:"El formato del email no es v\xe1lido"}},l=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fecha";if(!e)return{isValid:!1,error:"La ".concat(a," es requerida")};const r=new Date(e),t=new Date;return t.setHours(23,59,59,999),r instanceof Date&&!isNaN(r.getTime())?r>t?{isValid:!1,error:"La ".concat(a," no puede ser futura")}:{isValid:!0,error:null}:{isValid:!1,error:"La ".concat(a," no es v\xe1lida")}},d=e=>l(e,"fecha de nacimiento"),s=e=>l(e,"fecha de ingreso"),c=async e=>{try{if(!e)return{isValid:!1,error:"Debe seleccionar un participante"};const a=await t.C5.getParticipantes();if(a.data&&Array.isArray(a.data)){if(!a.data.some(a=>(a.id_participante||a.id)===parseInt(e)))return{isValid:!1,error:"El participante seleccionado no existe"}}return{isValid:!0,error:null}}catch(a){return console.error("Error validating participante exists:",a),{isValid:!1,error:"Error al validar el participante"}}},u=async e=>{try{if(!e)return{isValid:!1,error:"Debe seleccionar una sede"};const a=await t.C5.getSedes();if(a.data&&Array.isArray(a.data)){if(!a.data.some(a=>(a.id_sede||a.id)===parseInt(e)))return{isValid:!1,error:"La sede seleccionada no existe"}}return{isValid:!0,error:null}}catch(a){return console.error("Error validating sede exists:",a),{isValid:!1,error:"Error al validar la sede"}}},p=async(e,a)=>{const r=await c(e);if(!r.isValid)return r;const n=await(async e=>{try{if(!e)return{isValid:!1,error:"Debe seleccionar un acudiente"};const a=await t.C5.getAcudientes();return a.data&&Array.isArray(a.data)&&!a.data.some(a=>(a.id_acudiente||a.id)===parseInt(e))?{isValid:!1,error:"El acudiente seleccionado no existe"}:{isValid:!0,error:null}}catch(a){return console.error("Error validating acudiente exists:",a),{isValid:!1,error:"Error al validar el acudiente"}}})(a);return n.isValid?{isValid:!0,error:null}:n}}}]);
//# sourceMappingURL=101.252c4767.chunk.js.map