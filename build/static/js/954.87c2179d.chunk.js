"use strict";(self.webpackChunkfundacion_todo_por_un_alma=self.webpackChunkfundacion_todo_por_un_alma||[]).push([[954],{1389:(e,a,t)=>{t.d(a,{Bf:()=>d,Cb:()=>p,F:()=>i,NK:()=>r,SP:()=>s,Tq:()=>l,b2:()=>u,eS:()=>n,vc:()=>o,yY:()=>m});const n=e=>e?e.nombres&&e.apellidos?"".concat(e.nombres," ").concat(e.apellidos).trim():e.nombre||"N/A":"N/A",r=e=>e?"object"===typeof e&&null!==e?e.direccion||e.nombre||"N/A":String(e):"N/A",s=e=>{if(!e)return"N/A";const a=String(e).toUpperCase();return"ACTIVO"===a?"Activo":"INACTIVO"===a?"Inactivo":"PAGADA"===a?"Pagada":"PENDIENTE"===a?"Pendiente":"VENCIDA"===a?"Vencida":e},o=e=>e?"MASCULINO"===e?"Masculino":"FEMENINO"===e?"Femenino":e:"N/A",l=(e,a)=>{if(!a)return"N/A";return"".concat(e||"CC",": ").concat(a)},i=(e,a)=>{if(!e||!Array.isArray(e)||0===e.length)return"";return[a.map(e=>'"'.concat(e.label,'"')).join(";"),...e.map(e=>a.map(a=>{const t=c(e,a.key),n=String(t||"");return n.includes(";")||n.includes('"')||n.includes("\n")?'"'.concat(n.replace(/"/g,'""'),'"'):n}).join(";"))].join("\n")},d=(e,a)=>{const t=a.endsWith(".csv")?a:"".concat(a,".csv"),n=e.replace(/\n/g,"\r\n"),r=new Blob(["\ufeff"+n],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(void 0!==s.download){const e=URL.createObjectURL(r);s.setAttribute("href",e),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(e)}},c=(e,a)=>a.split(".").reduce((e,a)=>null===e||void 0===e?void 0:e[a],e),u=e=>{if(!e)return"";try{return new Date(e).toLocaleDateString("es-ES")}catch(a){return String(e)}},m=e=>{if(null===e||void 0===e)return"";try{return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e)}catch(a){return String(e)}},p=e=>{if(!e)return"";try{const a=new Date(e),t=new Date;let n=t.getFullYear()-a.getFullYear();const r=t.getMonth()-a.getMonth();return(r<0||0===r&&t.getDate()<a.getDate())&&n--,n>0?"".concat(n," a\xf1os"):""}catch(a){return""}}},3474:(e,a,t)=>{t.d(a,{A:()=>g});var n=t(9379),r=t(5043),s=t(8635),o=t(1688),l=t(2582),i=t(3001),d=t(579);const c=e=>{var a;let{isOpen:t=!1,onToggle:n=()=>{},isCollapsed:c=!1,onToggleCollapse:u=()=>{}}=e;const{currentUser:m,logout:p}=(0,s.As)(),g=(0,o.W6)(),[h,b]=(0,r.useState)(!1),x=(0,o.zy)(),f=(null===m||void 0===m?void 0:m.rol)||(null===m||void 0===m?void 0:m.role)||"CONSULTA";r.useEffect(()=>{const e=()=>{b(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const v=[{id:"dashboard",icon:"fas fa-home",label:"Dashboard",link:"/dashboard",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"participantes",icon:"fas fa-users",label:"Participantes",link:"/participantes",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"acudientes",icon:"fas fa-user-friends",label:"Acudientes",link:"/acudientes",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"financiero",icon:"fas fa-dollar-sign",label:"Mensualidades",link:"/financiero",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"usuarios",icon:"fas fa-users-cog",label:"Usuarios",link:"/usuarios",badge:null,roles:["ADMINISTRADOR"],adminOnly:!0},{id:"formatos",icon:"fas fa-file-alt",label:"Formatos",link:"/formatos",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"sedes",icon:"fas fa-building",label:"Sedes",link:"/sedes",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"configuracion",icon:"fas fa-cog",label:"Configuraci\xf3n",link:"/configuracion",badge:null,roles:["ADMINISTRADOR","CONSULTA"]}].filter(e=>e.roles.includes(f));return(0,d.jsxs)(d.Fragment,{children:[t&&h&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden transition-opacity duration-300",onClick:n,"aria-hidden":"true"}),h&&(0,d.jsx)("button",{onClick:n,className:"fixed top-4 right-4 z-[70] md:hidden bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 min-w-[48px] min-h-[48px] flex items-center justify-center","aria-label":t?"Cerrar men\xfa":"Abrir men\xfa",children:(0,d.jsx)("i",{className:"fas ".concat(t?"fa-times":"fa-bars"," text-xl transition-transform duration-200 ").concat(t?"rotate-90":"")})}),(0,d.jsxs)("aside",{"data-testid":"sidebar",className:"\n          fixed top-0 left-0 h-full text-gray-700 z-50\n          transform transition-transform duration-300 ease-in-out shadow-2xl\n          ".concat(h?"w-[280px] ".concat(t?"translate-x-0":"-translate-x-full"):c?"w-20 translate-x-0 hover:w-64":"w-64 translate-x-0","\n        "),style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.95) 100%)",backdropFilter:"blur(20px)",borderRight:"1px solid rgba(0, 0, 0, 0.1)"},children:[(0,d.jsxs)("div",{className:"\n          ".concat(c&&!h?"p-4":"p-5 md:p-6"," \n          border-b border-gray-200 \n          bg-gradient-to-r from-gray-50 to-gray-100 \n          transition-all duration-300 \n          relative\n        "),children:[!h&&(0,d.jsx)("button",{onClick:u,"aria-label":c?"Expandir men\xfa":"Colapsar men\xfa",className:"absolute -right-3 top-1/2 -translate-y-1/2 w-7 h-7 rounded-full bg-white border border-gray-200 shadow-md flex items-center justify-center hover:bg-gray-50 transition-colors z-10",children:(0,d.jsx)("i",{className:"fas ".concat(c?"fa-angle-double-right":"fa-angle-double-left"," text-sm text-gray-600")})}),(0,d.jsxs)("div",{className:"flex items-center ".concat(c&&!h?"justify-center":"space-x-3"),children:[(0,d.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,d.jsx)("img",{src:i,alt:"Corporaci\xf3n Logo",className:"\n                  ".concat(c&&!h?"w-10 h-10":"w-12 h-12 md:w-14 md:h-14"," \n                  rounded-xl object-cover bg-white p-2 shadow-md transition-all duration-300\n                ")}),(0,d.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 md:w-4 md:h-4 bg-green-500 rounded-full border-2 border-white shadow-sm"})]}),(0,d.jsxs)("div",{className:"".concat(c&&!h?"hidden":"block"," transition-all duration-300"),children:[(0,d.jsx)("h2",{className:"text-base md:text-lg font-Lato font-bold text-gray-800 leading-tight",children:"Corporaci\xf3n"}),(0,d.jsx)("p",{className:"text-xs font-Poppins text-gray-600",children:"Todo por un Alma"})]})]})]}),(0,d.jsx)("nav",{className:"p-3 md:p-4 flex-1 overflow-y-auto",children:(0,d.jsx)("ul",{className:"space-y-1",children:v.map(e=>(0,d.jsx)("li",{children:(0,d.jsxs)(l.N_,{to:e.link,className:"\n                    flex items-center \n                    ".concat(c&&!h?"justify-center px-3":"space-x-3 px-4"," \n                    py-3 md:py-3.5\n                    rounded-xl \n                    hover:bg-gray-100 hover:shadow-sm \n                    transition-all duration-200 \n                    group relative overflow-hidden\n                    min-h-[48px]\n                    ").concat(x.pathname.startsWith(e.link)?"bg-blue-50 text-blue-700 ring-1 ring-blue-100":"","\n                  "),onClick:h?n:void 0,"aria-current":x.pathname.startsWith(e.link)?"page":void 0,children:[(0,d.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-50/50 to-blue-25/30 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),(0,d.jsx)("i",{className:"\n                    ".concat(e.icon," \n                    ").concat(h?"text-xl":"text-lg","\n                    ").concat(x.pathname.startsWith(e.link)?"text-blue-700":"text-gray-600 group-hover:text-blue-600"," \n                    group-hover:scale-110 transition-all flex-shrink-0 relative z-10\n                  ")}),(0,d.jsx)("span",{className:"\n                    font-Poppins font-medium \n                    ".concat(h?"text-base":"text-sm","\n                    ").concat(x.pathname.startsWith(e.link)?"text-blue-800":"text-gray-700 group-hover:text-gray-900"," \n                    ").concat(c&&!h?"hidden":"block","\n                    transition-all duration-300 z-10\n                  "),children:e.label}),e.badge&&!c&&(0,d.jsx)("span",{className:"ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold shadow-sm",children:e.badge})]})},e.id))})}),(0,d.jsxs)("div",{className:"p-3 md:p-4 border-t border-gray-200 mt-auto bg-gradient-to-r from-gray-50 to-gray-100",children:[(0,d.jsxs)("div",{className:"\n            flex items-center \n            ".concat(c&&!h?"justify-center":"space-x-3"," \n            mb-3\n          "),children:[(0,d.jsxs)("div",{className:"relative flex-shrink-0",children:[null!==m&&void 0!==m&&m.photoURL?(0,d.jsx)("img",{src:m.photoURL,alt:"Usuario",className:"\n                    rounded-full border-2 border-gray-300 shadow-md \n                    ".concat(c&&!h?"w-10 h-10":"w-11 h-11 md:w-12 md:h-12","\n                  ")}):(0,d.jsx)("div",{className:"\n                  rounded-full border-2 border-gray-300 shadow-md \n                  bg-gradient-to-br from-blue-100 to-blue-200 \n                  flex items-center justify-center \n                  ".concat(c&&!h?"w-10 h-10":"w-11 h-11 md:w-12 md:h-12","\n                "),children:(0,d.jsx)("i",{className:"fas fa-user text-blue-600 ".concat(h?"text-lg":"text-base")})}),(0,d.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white shadow-sm"})]}),(!c||h)&&(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("p",{className:"text-sm md:text-base font-Poppins font-semibold text-gray-800 truncate",children:(null===m||void 0===m?void 0:m.displayName)||(null===m||void 0===m||null===(a=m.email)||void 0===a?void 0:a.split("@")[0])}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)("p",{className:"text-xs font-Poppins text-gray-600",children:"ADMINISTRADOR"===f?"Administrador":"Consulta"}),"CONSULTA"===f&&(0,d.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-1.5 py-0.5 rounded",title:"Solo lectura",children:(0,d.jsx)("i",{className:"fas fa-eye text-[10px]"})})]})]})]}),(0,d.jsxs)("button",{onClick:async()=>{try{await p(),g.push("/")}catch(e){console.error("Error during logout:",e)}},className:"\n              flex items-center \n              ".concat(c&&!h?"justify-center":""," \n              w-full px-4 py-3\n              text-sm md:text-base\n              text-gray-700 \n              rounded-xl \n              hover:bg-red-50 hover:text-red-600 hover:shadow-sm \n              transition-all duration-200 \n              font-Poppins font-medium \n              group relative overflow-hidden\n              min-h-[48px]\n            "),children:[(0,d.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-red-50/50 to-red-25/30 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),(0,d.jsx)("i",{className:"\n              fas fa-sign-out-alt \n              ".concat(h?"text-lg":"text-base","\n              ").concat(c&&!h?"":"mr-3"," \n              group-hover:scale-110 transition-transform relative z-10\n            ")}),(!c||h)&&(0,d.jsx)("span",{className:"relative z-10",children:"Cerrar Sesi\xf3n"})]})]})]})]})},u=r.memo(e=>{let{title:a="Dashboard",subtitle:t="Bienvenido",extraActions:n=null}=e;const{currentUser:l,logout:c}=(0,s.As)(),u=(0,o.W6)(),{sidebarCollapsed:m}=(0,s.VF)(),[p,g]=(0,r.useState)(!1),h=(0,r.useRef)(null);(0,r.useEffect)(()=>{const e=e=>{h.current&&!h.current.contains(e.target)&&g(!1)},a=e=>{"Escape"===e.key&&g(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",a)}},[]);const b=(0,r.useCallback)(async e=>{e&&(e.preventDefault(),e.stopPropagation());try{await c(),g(!1),u.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}},[u,c]),x=(0,r.useCallback)(async()=>{try{null!==l&&void 0!==l&&l.email&&(await navigator.clipboard.writeText(l.email),g(!1))}catch(e){console.error("No se pudo copiar el correo",e)}},[null===l||void 0===l?void 0:l.email]),f=(0,r.useCallback)(()=>{g(e=>!e)},[]),v=(0,r.useMemo)(()=>m?"md:ml-20":"md:ml-64",[m]),y=(0,r.useMemo)(()=>(null===l||void 0===l?void 0:l.displayName)||(null===l||void 0===l?void 0:l.email),[null===l||void 0===l?void 0:l.displayName,null===l||void 0===l?void 0:l.email]);return(0,d.jsx)("header",{className:"\n      fixed top-0 right-0 left-0 z-40 \n      bg-white/95 backdrop-blur-lg \n      shadow-md border-b border-gray-200\n      transition-all duration-300\n    ",children:(0,d.jsx)("div",{className:"\n        px-4 md:px-6 \n        py-2.5 md:py-3 \n        transition-all duration-300 \n        ".concat(v,"\n      "),children:(0,d.jsxs)("div",{className:"flex items-center justify-between gap-2 md:gap-4",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 md:space-x-3 flex-1 min-w-0 ml-12 md:ml-0",children:[(0,d.jsx)("img",{src:i,alt:"Todo por un Alma",className:"hidden sm:block h-8 md:h-10 w-8 md:w-10 rounded-lg shadow-sm flex-shrink-0"}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("h1",{className:"text-base sm:text-lg md:text-2xl font-Lato font-bold text-gray-800 truncate",children:a}),t&&(0,d.jsx)("p",{className:"hidden md:block text-xs md:text-sm font-Poppins text-gray-600 truncate",children:t})]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 md:space-x-4 flex-shrink-0",children:[n&&(0,d.jsx)("div",{className:"hidden lg:flex items-center space-x-3",children:n}),(0,d.jsxs)("div",{className:"relative",ref:h,children:[(0,d.jsxs)("button",{onClick:f,className:"flex items-center space-x-2 md:space-x-3 bg-gray-100 rounded-full pl-1.5 md:pl-2 pr-2 md:pr-3 py-1 md:py-1.5 hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[44px]","aria-haspopup":"true","aria-expanded":p,children:[(0,d.jsxs)("div",{className:"relative flex-shrink-0",children:[null!==l&&void 0!==l&&l.photoURL?(0,d.jsx)("img",{src:l.photoURL,alt:"Usuario",className:"w-8 h-8 md:w-9 md:h-9 rounded-full border-2 border-blue-500"}):(0,d.jsx)("div",{className:"w-8 h-8 md:w-9 md:h-9 rounded-full border-2 border-blue-500 bg-blue-500 flex items-center justify-center",children:(0,d.jsx)("i",{className:"fas fa-user text-white text-sm"})}),(0,d.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 md:w-3 md:h-3 bg-green-400 rounded-full border-2 border-white"})]}),(0,d.jsx)("span",{className:"hidden sm:block text-sm md:text-base font-Poppins font-medium text-gray-700 max-w-[120px] md:max-w-none truncate",children:y}),(0,d.jsx)("i",{className:"hidden sm:block fas fa-chevron-".concat(p?"up":"down"," text-gray-500 text-xs")})]}),p&&(0,d.jsxs)("div",{className:"absolute right-0 mt-2 w-56 md:w-64 bg-white border border-gray-200 rounded-xl shadow-xl z-50 overflow-hidden",children:[(0,d.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50",children:[(0,d.jsx)("p",{className:"text-xs text-gray-500 font-Poppins",children:"Sesi\xf3n iniciada como"}),(0,d.jsx)("p",{className:"text-sm md:text-base text-gray-800 truncate font-Poppins font-medium mt-0.5",children:null===l||void 0===l?void 0:l.email})]}),(0,d.jsxs)("ul",{className:"py-1",children:[(0,d.jsx)("li",{children:(0,d.jsxs)("button",{onClick:x,className:"w-full flex items-center px-4 py-3 text-sm md:text-base text-gray-700 hover:bg-gray-50 font-Poppins transition-colors min-h-[48px]",children:[(0,d.jsx)("i",{className:"fas fa-copy mr-3 text-gray-500 w-4"}),"Copiar correo"]})}),(0,d.jsx)("li",{children:(0,d.jsxs)("button",{onClick:()=>{u.push("/configuracion"),g(!1)},className:"w-full flex items-center px-4 py-3 text-sm md:text-base text-gray-700 hover:bg-gray-50 font-Poppins transition-colors min-h-[48px]",children:[(0,d.jsx)("i",{className:"fas fa-cog mr-3 text-gray-500 w-4"}),"Configuraci\xf3n"]})}),(0,d.jsx)("li",{className:"border-t border-gray-100",children:(0,d.jsxs)("button",{onClick:b,className:"w-full flex items-center px-4 py-3 text-sm md:text-base text-red-600 hover:bg-red-50 font-Poppins transition-colors min-h-[48px]",children:[(0,d.jsx)("i",{className:"fas fa-sign-out-alt mr-3 w-4"}),"Cerrar sesi\xf3n"]})})]})]})]})]})]})})})});var m=t(6761);const p=e=>{let{title:a="Dashboard",subtitle:t="",children:n,loading:r=!1,loadingText:o="Cargando...",extraActions:l=null}=e;const{sidebarOpen:i,sidebarCollapsed:p,toggleSidebarOpen:g,toggleSidebarCollapsed:h}=(0,s.VF)(),b=p?"md:ml-20":"md:ml-64";return r?(0,d.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:(0,d.jsxs)("div",{className:"flex",children:[(0,d.jsx)(c,{isOpen:i,onToggle:g,isCollapsed:p,onToggleCollapse:h}),(0,d.jsx)("main",{className:"flex-1 transition-all duration-300 ".concat(b," pt-16 md:pt-20 px-4 md:px-0"),children:(0,d.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,d.jsx)(m.A,{size:"xl",text:o})})})]})}):(0,d.jsx)("div",{className:"min-h-screen bg-gray-50 font-sans antialiased",children:(0,d.jsxs)("div",{className:"flex",children:[(0,d.jsx)(c,{isOpen:i,onToggle:g,isCollapsed:p,onToggleCollapse:h}),(0,d.jsxs)("main",{className:"flex-1 transition-all duration-300 ".concat(b," pt-16 md:pt-20 px-4 md:px-0"),children:[(0,d.jsx)(u,{title:a,subtitle:t,extraActions:l}),n]})]})})},g=e=>(0,d.jsx)(s.GB,{children:(0,d.jsx)(p,(0,n.A)({},e))})},4349:(e,a,t)=>{t.d(a,{C5:()=>r.C5,FH:()=>n.FH,gg:()=>r.gg});var n=t(493),r=t(5848);t(6752),t(7479)},6938:(e,a,t)=>{t.d(a,{BZ:()=>s,DT:()=>o,F2:()=>m,Hc:()=>d,Ri:()=>r,Wk:()=>u,Zi:()=>i,ju:()=>c});var n=t(4349);const r=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!e||!e.trim())return{isValid:!1,error:"El n\xfamero de documento es requerido"};const t=await n.C5.getParticipantes();if(t.data&&Array.isArray(t.data)){if(t.data.some(t=>{const n=t.id||t.id_participante;return t.numero_documento===e&&n!==a}))return{isValid:!1,error:"El n\xfamero de documento ya est\xe1 registrado para otro participante"}}return{isValid:!0,error:null}}catch(t){return console.error("Error validating participante documento:",t),{isValid:!0,error:null}}},s=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!e||!e.trim())return{isValid:!1,error:"El n\xfamero de documento es requerido"};const t=await n.C5.getAcudientes();if(t.data&&Array.isArray(t.data)){if(t.data.some(t=>{const n=t.id||t.id_acudiente;return t.numero_documento===e&&n!==a}))return{isValid:!1,error:"El n\xfamero de documento ya est\xe1 registrado para otro acudiente"}}return{isValid:!0,error:null}}catch(t){return console.error("Error validating acudiente documento:",t),{isValid:!0,error:null}}},o=e=>{if(!e||!e.trim())return{isValid:!1,error:"El email es requerido"};return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?{isValid:!0,error:null}:{isValid:!1,error:"El formato del email no es v\xe1lido"}},l=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fecha";if(!e)return{isValid:!1,error:"La ".concat(a," es requerida")};const t=new Date(e),n=new Date;return n.setHours(23,59,59,999),t instanceof Date&&!isNaN(t.getTime())?t>n?{isValid:!1,error:"La ".concat(a," no puede ser futura")}:{isValid:!0,error:null}:{isValid:!1,error:"La ".concat(a," no es v\xe1lida")}},i=e=>l(e,"fecha de nacimiento"),d=e=>l(e,"fecha de ingreso"),c=async e=>{try{if(!e)return{isValid:!1,error:"Debe seleccionar un participante"};const a=await n.C5.getParticipantes();if(a.data&&Array.isArray(a.data)){if(!a.data.some(a=>(a.id_participante||a.id)===parseInt(e)))return{isValid:!1,error:"El participante seleccionado no existe"}}return{isValid:!0,error:null}}catch(a){return console.error("Error validating participante exists:",a),{isValid:!1,error:"Error al validar el participante"}}},u=async e=>{try{if(!e)return{isValid:!1,error:"Debe seleccionar una sede"};const a=await n.C5.getSedes();if(a.data&&Array.isArray(a.data)){if(!a.data.some(a=>(a.id_sede||a.id)===parseInt(e)))return{isValid:!1,error:"La sede seleccionada no existe"}}return{isValid:!0,error:null}}catch(a){return console.error("Error validating sede exists:",a),{isValid:!1,error:"Error al validar la sede"}}},m=async(e,a)=>{const t=await c(e);if(!t.isValid)return t;const r=await(async e=>{try{if(!e)return{isValid:!1,error:"Debe seleccionar un acudiente"};const a=await n.C5.getAcudientes();return a.data&&Array.isArray(a.data)&&!a.data.some(a=>(a.id_acudiente||a.id)===parseInt(e))?{isValid:!1,error:"El acudiente seleccionado no existe"}:{isValid:!0,error:null}}catch(a){return console.error("Error validating acudiente exists:",a),{isValid:!1,error:"Error al validar el acudiente"}}})(a);return r.isValid?{isValid:!0,error:null}:r}},6954:(e,a,t)=>{t.r(a),t.d(a,{default:()=>p});var n=t(9379),r=t(5043),s=t(3474),o=t(4349),l=t(3714),i=t(1724),d=t(6938),c=t(1389),u=t(579);const m=e=>{let{value:a,onChange:t,label:n="Per\xedodo"}=e;const s=(0,r.useMemo)(()=>[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],[]),o=(0,r.useMemo)(()=>Array.from({length:11},(e,a)=>2020+a),[]),l=(0,r.useMemo)(()=>{const e=[{value:"all",label:"Todos"}];return o.forEach(a=>{s.forEach(t=>{e.push({value:"".concat(t.value,"-").concat(a),label:"".concat(t.label," ").concat(a)})})}),e},[s,o]);return(0,u.jsxs)("div",{className:"w-full",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n}),(0,u.jsx)("select",{value:a,onChange:e=>t(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:l.map(e=>(0,u.jsx)("option",{value:e.value,children:e.label},e.value))})]})},p=r.memo(()=>{const[e,a]=(0,r.useState)([]),[t,p]=(0,r.useState)([]),[g,h]=(0,r.useState)([]),[b,x]=(0,r.useState)([]),[f,v]=(0,r.useState)([]),[y,N]=(0,r.useState)(null),[j,A]=(0,r.useState)(!0),[w,C]=(0,r.useState)({participant_id:"",id_acudiente:"",mes:"","a\xf1o":(new Date).getFullYear(),valor:"",status:"PAGADO",metodo_pago:"TRANSFERENCIA",fecha_pago:"",observaciones:""}),{filters:_,setFilter:E,clearFilters:k}=(0,l.R7)({periodo:"all",sede:"all",estado:"all",busqueda:""}),{isOpen:D,openModal:S,closeModal:P,modalData:T,updateModalData:O}=(0,l.hS)(),I=(0,r.useCallback)((e,a)=>{C(t=>(0,n.A)((0,n.A)({},t),{},{[e]:a}))},[]),M=(0,r.useMemo)(()=>[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],[]),F=(0,r.useMemo)(()=>Array.from({length:11},(e,a)=>2020+a),[]),R=(0,r.useCallback)(e=>{const a=M.find(a=>a.value===e);return a?a.label:e.toString()},[M]);(0,r.useEffect)(()=>{(async()=>{try{var e,t,n,r;A(!0),N(null),console.log("\ud83d\udd04 Cargando datos financieros...");const[s,l,i,d]=await Promise.all([o.C5.getMensualidades(),o.C5.getParticipantes(),o.C5.getSedes(),o.C5.getAcudientes()]);console.log("\ud83d\udcca Resultados crudos:",{mensRes:{data:s.data,error:s.error},partsRes:{data:l.data,error:l.error},sedesRes:{data:i.data,error:i.error},acudRes:{data:d.data,error:d.error}});const c=Array.isArray(s.data)?s.data:null!==(e=s.data)&&void 0!==e&&e.data?s.data.data:[],u=Array.isArray(l.data)?l.data:null!==(t=l.data)&&void 0!==t&&t.data?l.data.data:[],m=Array.isArray(i.data)?i.data:null!==(n=i.data)&&void 0!==n&&n.data?i.data.data:[],g=Array.isArray(d.data)?d.data:null!==(r=d.data)&&void 0!==r&&r.data?d.data.data:[];console.log("\ud83d\udd0d Estructura de mensualidadesData:",{isArray:Array.isArray(c),length:c.length,firstItem:c[0]||"No hay elementos",rawResponse:s}),a(c),p(u),h(m),x(g),v(g),console.log("\u2705 Datos cargados:",{mensualidades:c.length,participantes:u.length,sedes:m.length,acudientes:g.length})}catch(s){console.error("\u274c Error cargando datos financieros:",s),N(s.message||"Error desconocido al cargar datos"),a([]),p([]),h([]),x([])}finally{A(!1)}})()},[]),(0,r.useEffect)(()=>{if(w.participant_id){const e=b.filter(e=>e.id_participante===parseInt(w.participant_id));v(e),w.id_acudiente&&!e.find(e=>e.id_acudiente===parseInt(w.id_acudiente))&&C(e=>(0,n.A)((0,n.A)({},e),{},{id_acudiente:""}))}else v(b)},[w.participant_id,b,w.id_acudiente]);const V=(0,r.useMemo)(()=>{const a=Array.isArray(e)?e:[];let t=a;if(console.log("\ud83d\udd0d Aplicando filtros:",{filtrosActivos:_,mensualidadesTotal:a.length,mensualidadesMuestra:a.slice(0,3)}),"all"!==_.periodo){const[e,a]=_.periodo.split("-").map(Number);console.log("\ud83d\udcc5 Filtrando por per\xedodo:",{mes:e,"a\xf1o":a}),t=t.filter(t=>t.mes===e&&t.a\u00f1o===a),console.log("\ud83d\udcc5 Despu\xe9s de filtro per\xedodo:",t.length)}return"all"!==_.sede&&(console.log("\ud83c\udfe2 Filtrando por sede:",_.sede),t=t.filter(e=>e.sede_id===parseInt(_.sede)),console.log("\ud83c\udfe2 Despu\xe9s de filtro sede:",t.length)),"all"!==_.estado&&(console.log("\ud83d\udcca Filtrando por estado:",_.estado),t=t.filter(e=>e.estado===_.estado),console.log("\ud83d\udcca Despu\xe9s de filtro estado:",t.length)),_.busqueda&&(console.log("\ud83d\udd0d Filtrando por b\xfasqueda:",_.busqueda),t=t.filter(e=>(e.participant_documento||"").includes(_.busqueda)||(e.acudiente_documento||"").includes(_.busqueda)),console.log("\ud83d\udd0d Despu\xe9s de filtro b\xfasqueda:",t.length)),console.log("\u2705 Resultado final del filtrado:",{totalFiltrado:t.length,filtrosAplicados:Object.keys(_).filter(e=>"all"!==_[e]&&""!==_[e])}),t},[e,_]),{currentPage:L,totalPages:U,paginatedData:q,setPage:z}=(0,l.WQ)(V,10),G=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(C({participant_id:e.participante_id||e.participant_id,id_acudiente:e.id_acudiente||"",mes:e.mes,"a\xf1o":e.a\u00f1o,valor:e.valor||e.monto,status:e.estado||e.status,metodo_pago:e.metodo_pago||"TRANSFERENCIA",fecha_pago:e.fecha_pago||"",observaciones:e.observaciones||""}),O(e)):(C({participant_id:"",id_acudiente:"",mes:"","a\xf1o":(new Date).getFullYear(),valor:"",status:"PAGADO",metodo_pago:"TRANSFERENCIA",fecha_pago:"",observaciones:""}),O(null)),S()},[S,O]),W=(0,r.useCallback)(async(e,t)=>{try{await o.C5.updateMensualidad(e,{estado:t});const{data:n}=await o.C5.getMensualidades();a(n||[])}catch(n){console.error("Error updating status:",n)}},[]),B=(0,r.useCallback)(async e=>{if(e.preventDefault(),"PAGADO"===w.status&&!w.fecha_pago)return void alert("La fecha de pago es requerida cuando el estado es PAGADO");try{if(w.id_acudiente){const e=await(0,d.F2)(parseInt(w.participant_id),parseInt(w.id_acudiente));if(!e.isValid)return void alert(e.error)}}catch(n){return console.error("Error validating relations:",n),void alert("Error al validar las relaciones: "+(n.message||"Error desconocido"))}const t={participant_id:parseInt(w.participant_id),id_acudiente:w.id_acudiente?parseInt(w.id_acudiente):null,mes:parseInt(w.mes),"a\xf1o":parseInt(w.a\u00f1o),monto:parseFloat(w.valor),estado:w.status,metodo_pago:w.metodo_pago,fecha_pago:"PAGADO"===w.status?w.fecha_pago:null,observaciones:w.observaciones||null};try{null!==T&&void 0!==T&&T.id?await o.C5.updateMensualidad(T.id,t):await o.C5.createMensualidad(t),P();const{data:e}=await o.C5.getMensualidades();a(e||[])}catch(n){console.error("Error saving payment:",n),alert("Error al guardar la mensualidad: "+(n.message||"Error desconocido"))}},[w,T,P]),Y=(0,r.useCallback)(()=>{const e=window.open("","_blank"),a=(new Date).toLocaleDateString("es-ES"),t="\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Lista de Mensualidades - ".concat(a,'</title>\n          <style>\n            body {\n              font-family: Arial, sans-serif;\n              margin: 20px;\n              color: #333;\n            }\n            .header {\n              text-align: center;\n              margin-bottom: 30px;\n              border-bottom: 2px solid #333;\n              padding-bottom: 20px;\n            }\n            .header h1 {\n              color: #2563eb;\n              margin: 0;\n              font-size: 24px;\n            }\n            table {\n              width: 100%;\n              border-collapse: collapse;\n              margin-top: 20px;\n            }\n            th, td {\n              border: 1px solid #ddd;\n              padding: 8px 12px;\n              text-align: left;\n            }\n            th {\n              background-color: #f8f9fa;\n              font-weight: bold;\n              color: #495057;\n            }\n            tr:nth-child(even) {\n              background-color: #f9f9f9;\n            }\n            @media print {\n              body { margin: 0; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <h1>Lista de Mensualidades</h1>\n            <p>Corporaci\xf3n Todo por un Alma</p>\n            <p>Fecha de generaci\xf3n: ').concat(a,"</p>\n          </div>\n\n          <table>\n            <thead>\n              <tr>\n                <th>Participante</th>\n                <th>Acudiente</th>\n                <th>Mes</th>\n                <th>A\xf1o</th>\n                <th>Valor</th>\n                <th>Estado</th>\n                <th>M\xe9todo de Pago</th>\n              </tr>\n            </thead>\n            <tbody>\n              ").concat(V.map(e=>"\n                <tr>\n                  <td>".concat(e.participant_name||"N/A","</td>\n                  <td>").concat(e.acudiente_name||"N/A","</td>\n                  <td>").concat(R(e.mes),"</td>\n                  <td>").concat(e.a\u00f1o||"N/A","</td>\n                  <td>$").concat((e.valor||e.monto||0).toLocaleString(),"</td>\n                  <td>").concat((0,c.SP)(e.estado||e.status),"</td>\n                  <td>").concat(e.metodo_pago||"N/A","</td>\n                </tr>\n              ")).join(""),"\n            </tbody>\n          </table>\n\n          <script>\n            window.onload = function() {\n              window.print();\n              setTimeout(function() {\n                window.close();\n              }, 1000);\n            }\n          <\/script>\n        </body>\n      </html>\n    ");e.document.write(t),e.document.close()},[V,R]),X=(0,r.useCallback)(()=>{const e=V.map(e=>({id:e.id||"N/A",participant_name:e.participant_name||"N/A",participant_documento:e.participant_documento||"N/A",acudiente_name:e.acudiente_name||"N/A",acudiente_documento:e.acudiente_documento||"N/A",mes:R(e.mes),"a\xf1o":e.a\u00f1o||"N/A",periodo:"".concat(R(e.mes)," ").concat(e.a\u00f1o),valor:(0,c.yY)(e.valor||e.monto||0),estado:(0,c.SP)(e.estado||e.status),metodo_pago:"TRANSFERENCIA"===e.metodo_pago?"Transferencia":"EFECTIVO"===e.metodo_pago?"Efectivo":"N/A",fecha_pago:(0,c.b2)(e.fecha_pago),observaciones:e.observaciones||"N/A"})),a=(0,c.F)(e,[{key:"id",label:"ID"},{key:"participant_name",label:"Participante"},{key:"participant_documento",label:"Documento Participante"},{key:"acudiente_name",label:"Acudiente"},{key:"acudiente_documento",label:"Documento Acudiente"},{key:"mes",label:"Mes"},{key:"a\xf1o",label:"A\xf1o"},{key:"periodo",label:"Per\xedodo"},{key:"valor",label:"Valor"},{key:"estado",label:"Estado"},{key:"metodo_pago",label:"M\xe9todo de Pago"},{key:"fecha_pago",label:"Fecha Pago"},{key:"observaciones",label:"Observaciones"}]),t="mensualidades_".concat((new Date).toISOString().split("T")[0],".csv");(0,c.Bf)(a,t)},[V,R,_,g]);return j?(0,u.jsx)(s.A,{title:"Mensualidades",subtitle:"Cargando mensualidades...",loading:!0,children:(0,u.jsx)(i.kt,{})}):y?(0,u.jsx)(s.A,{title:"Mensualidades",subtitle:"Error al cargar datos",loading:!1,children:(0,u.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,u.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,u.jsxs)("p",{className:"text-red-600",children:["Error loading payments: ",y]})})})}):(0,u.jsxs)(s.A,{title:"Mensualidades",subtitle:"Pagadas, pendientes y vencidas",extraActions:(0,u.jsxs)("div",{className:"flex space-x-3",children:[(0,u.jsx)(i.EK,{onExportPDF:Y,onExportCSV:X}),(0,u.jsxs)("button",{onClick:()=>G(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,u.jsx)("i",{className:"fas fa-plus mr-2"}),"Nueva Mensualidad"]})]}),children:[(0,u.jsxs)("section",{className:"px-4 md:px-6 py-4 md:py-6",children:[(0,u.jsx)(i.Qn,{filters:[{type:"custom",name:"periodo",component:m,props:{label:"Per\xedodo"}},{type:"select",name:"sede",label:"Sede",placeholder:"Todas",options:[{value:"all",label:"Todas"},...g.map(e=>({value:e.id.toString(),label:e.nombre}))]},{type:"select",name:"estado",label:"Estado",placeholder:"Todos",options:[{value:"all",label:"Todos"},{value:"PAGADO",label:"Pagada"},{value:"PENDIENTE",label:"Pendiente"}]},{type:"search",name:"busqueda",label:"B\xfasqueda por Documento",placeholder:"N\xfamero de documento..."}],values:_,onChange:E,onClear:k,showClearButton:!0}),(0,u.jsxs)("div",{className:"mt-6",children:[(0,u.jsx)(i.bQ,{data:q,columns:[{key:"participant_name",header:"Participante",render:e=>(0,u.jsx)("span",{className:"font-medium text-gray-900",children:e.participant_name})},{key:"acudiente_name",header:"Acudiente",render:e=>(0,u.jsx)("span",{className:"text-gray-700",children:e.acudiente_name||"N/A"})},{key:"mes",header:"Mes",render:e=>R(e.mes)},{key:"valor",header:"Cantidad",render:e=>"$".concat((e.valor||e.monto||0).toLocaleString())},{key:"metodo_pago",header:"M\xe9todo de Pago",render:e=>(0,u.jsx)("span",{className:"text-sm text-gray-600",children:"TRANSFERENCIA"===e.metodo_pago?"Transferencia":"EFECTIVO"===e.metodo_pago?"Efectivo":"N/A"})},{key:"status",header:"Estado",render:e=>(0,u.jsx)(i.re,{currentStatus:e.status||e.estado,statuses:[{value:"PAGADO",label:"PAGADO",variant:"success"},{value:"PENDIENTE",label:"PENDIENTE",variant:"danger"}],onChange:a=>W(e.id,a)})},{key:"observaciones",header:"Observaciones",render:e=>(0,u.jsx)("span",{className:"text-sm text-gray-600 truncate max-w-xs block",title:e.observaciones||"",children:e.observaciones?e.observaciones.length>30?e.observaciones.substring(0,30)+"...":e.observaciones:"-"})},{key:"actions",header:"Acciones",render:e=>(0,u.jsx)(i.yd,{actions:[{label:"Ver",icon:"fas fa-eye",onClick:()=>G(e)},{label:"Editar",icon:"fas fa-edit",onClick:()=>G(e)}]})}],keyExtractor:e=>e.id,loading:j,emptyState:(0,u.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,u.jsx)("div",{className:"mb-4",children:(0,u.jsx)("strong",{children:"No hay mensualidades que mostrar"})}),(0,u.jsxs)("div",{className:"text-sm text-gray-400 space-y-1",children:[(0,u.jsxs)("div",{children:["\ud83d\udcca Total mensualidades en BD: ",e.length]}),(0,u.jsxs)("div",{children:["\ud83d\udd0d Despu\xe9s de filtros: ",V.length]}),(0,u.jsxs)("div",{children:["\u2699\ufe0f Filtros activos: ",Object.keys(_).filter(e=>"all"!==_[e]&&""!==_[e]).length>0?Object.keys(_).filter(e=>"all"!==_[e]&&""!==_[e]).join(", "):"Ninguno"]}),(0,u.jsxs)("div",{children:["\ud83d\udd27 Estado de carga: ",j?"Cargando...":"Completado"]}),y&&(0,u.jsxs)("div",{className:"text-red-400",children:["\u274c Error: ",y]})]})]})}),U>1&&(0,u.jsx)(i.dK,{currentPage:L,totalPages:U,onPageChange:z,itemsPerPage:10,totalItems:V.length,showInfo:!0,className:"mt-4"})]})]}),(0,u.jsx)(i.k5,{isOpen:D,onClose:P,title:T?"Ver/Editar Mensualidad":"Nueva Mensualidad",onSubmit:B,submitLabel:"Guardar",size:"lg",children:(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsx)(i.FX,{label:"Participante",name:"participant_id",value:w.participant_id,onChange:e=>I("participant_id",e),options:t.map(e=>({value:e.id,label:"".concat(e.nombres," ").concat(e.apellidos," - ").concat(e.documento)})),placeholder:"Seleccionar Participante",required:!0}),(0,u.jsx)(i.FX,{label:"Acudiente",name:"id_acudiente",value:w.id_acudiente,onChange:e=>I("id_acudiente",e),options:f.map(e=>({value:e.id_acudiente||e.id,label:"".concat(e.nombres," ").concat(e.apellidos," - ").concat(e.parentesco)})),placeholder:"Seleccionar Acudiente",disabled:!w.participant_id}),(0,u.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,u.jsx)(i.FX,{label:"Mes",name:"mes",value:w.mes,onChange:e=>I("mes",e),options:M.map(e=>({value:e.value,label:e.label})),placeholder:"Seleccionar Mes",required:!0}),(0,u.jsx)(i.FX,{label:"A\xf1o",name:"a\xf1o",value:w.a\u00f1o,onChange:e=>I("a\xf1o",e),options:F.map(e=>({value:e,label:e.toString()})),required:!0})]}),(0,u.jsx)(i.ZQ,{label:"Valor",name:"valor",type:"number",value:w.valor,onChange:e=>I("valor",e),placeholder:"Valor",required:!0}),(0,u.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,u.jsx)(i.FX,{label:"Estado",name:"status",value:w.status,onChange:e=>I("status",e),options:[{value:"PAGADO",label:"Pagada"},{value:"PENDIENTE",label:"Pendiente"}],required:!0}),(0,u.jsx)(i.FX,{label:"M\xe9todo de Pago",name:"metodo_pago",value:w.metodo_pago,onChange:e=>I("metodo_pago",e),options:[{value:"TRANSFERENCIA",label:"Transferencia"},{value:"EFECTIVO",label:"Efectivo"}],required:!0})]}),"PAGADO"===w.status&&(0,u.jsx)(i.ZQ,{label:"Fecha de Pago",name:"fecha_pago",type:"date",value:w.fecha_pago,onChange:e=>I("fecha_pago",e),required:"PAGADO"===w.status}),(0,u.jsx)(i.hg,{label:"Observaciones",name:"observaciones",value:w.observaciones,onChange:e=>I("observaciones",e),placeholder:"Observaciones adicionales...",rows:3}),T&&(0,u.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,u.jsx)("h4",{className:"font-semibold text-gray-700 mb-2",children:"Informaci\xf3n Completa"}),(0,u.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"text-gray-600",children:"Participante:"}),(0,u.jsx)("span",{className:"ml-2 font-medium",children:T.participant_name})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"text-gray-600",children:"Acudiente:"}),(0,u.jsx)("span",{className:"ml-2 font-medium",children:T.acudiente_name||"N/A"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"text-gray-600",children:"M\xe9todo de Pago:"}),(0,u.jsx)("span",{className:"ml-2 font-medium",children:"TRANSFERENCIA"===T.metodo_pago?"Transferencia":"EFECTIVO"===T.metodo_pago?"Efectivo":"N/A"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"text-gray-600",children:"Fecha de Pago:"}),(0,u.jsx)("span",{className:"ml-2 font-medium",children:T.fecha_pago?new Date(T.fecha_pago).toLocaleDateString():"N/A"})]}),T.observaciones&&(0,u.jsxs)("div",{className:"col-span-2",children:[(0,u.jsx)("span",{className:"text-gray-600",children:"Observaciones:"}),(0,u.jsx)("p",{className:"ml-2 mt-1 text-gray-700",children:T.observaciones})]})]})]})]})})]})})}}]);
//# sourceMappingURL=954.87c2179d.chunk.js.map