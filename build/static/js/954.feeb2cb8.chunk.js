"use strict";(self.webpackChunkfundacion_todo_por_un_alma=self.webpackChunkfundacion_todo_por_un_alma||[]).push([[954],{3474:(e,a,s)=>{s.d(a,{A:()=>x});var t=s(9379),r=s(5043),n=s(8635),l=s(1688),i=s(2582),o=s(3001),d=s(579);const c=e=>{var a;let{isOpen:s=!1,onToggle:t=()=>{},isCollapsed:c=!1,onToggleCollapse:u=()=>{}}=e;const{currentUser:m,logout:p}=(0,n.As)(),x=(0,l.W6)(),[g,h]=(0,r.useState)(!1),b=(0,l.zy)(),f=(null===m||void 0===m?void 0:m.rol)||(null===m||void 0===m?void 0:m.role)||"CONSULTA";r.useEffect(()=>{const e=()=>{h(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const v=[{id:"dashboard",icon:"fas fa-home",label:"Dashboard",link:"/dashboard",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"participantes",icon:"fas fa-users",label:"Participantes",link:"/participantes",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"acudientes",icon:"fas fa-user-friends",label:"Acudientes",link:"/acudientes",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"financiero",icon:"fas fa-dollar-sign",label:"Mensualidades",link:"/financiero",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"usuarios",icon:"fas fa-users-cog",label:"Usuarios",link:"/usuarios",badge:null,roles:["ADMINISTRADOR"],adminOnly:!0},{id:"formatos",icon:"fas fa-file-alt",label:"Formatos",link:"/formatos",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"sedes",icon:"fas fa-building",label:"Sedes",link:"/sedes",badge:null,roles:["ADMINISTRADOR","CONSULTA"]},{id:"configuracion",icon:"fas fa-cog",label:"Configuraci\xf3n",link:"/configuracion",badge:null,roles:["ADMINISTRADOR","CONSULTA"]}].filter(e=>e.roles.includes(f));return(0,d.jsxs)(d.Fragment,{children:[s&&g&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden transition-opacity duration-300",onClick:t,"aria-hidden":"true"}),g&&(0,d.jsx)("button",{onClick:t,className:"fixed top-4 right-4 z-[70] md:hidden bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 min-w-[48px] min-h-[48px] flex items-center justify-center","aria-label":s?"Cerrar men\xfa":"Abrir men\xfa",children:(0,d.jsx)("i",{className:"fas ".concat(s?"fa-times":"fa-bars"," text-xl transition-transform duration-200 ").concat(s?"rotate-90":"")})}),(0,d.jsxs)("aside",{"data-testid":"sidebar",className:"\n          fixed top-0 left-0 h-full text-gray-700 z-50\n          transform transition-transform duration-300 ease-in-out shadow-2xl\n          ".concat(g?"w-[280px] ".concat(s?"translate-x-0":"-translate-x-full"):c?"w-20 translate-x-0 hover:w-64":"w-64 translate-x-0","\n        "),style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.95) 100%)",backdropFilter:"blur(20px)",borderRight:"1px solid rgba(0, 0, 0, 0.1)"},children:[(0,d.jsxs)("div",{className:"\n          ".concat(c&&!g?"p-4":"p-5 md:p-6"," \n          border-b border-gray-200 \n          bg-gradient-to-r from-gray-50 to-gray-100 \n          transition-all duration-300 \n          relative\n        "),children:[!g&&(0,d.jsx)("button",{onClick:u,"aria-label":c?"Expandir men\xfa":"Colapsar men\xfa",className:"absolute -right-3 top-1/2 -translate-y-1/2 w-7 h-7 rounded-full bg-white border border-gray-200 shadow-md flex items-center justify-center hover:bg-gray-50 transition-colors z-10",children:(0,d.jsx)("i",{className:"fas ".concat(c?"fa-angle-double-right":"fa-angle-double-left"," text-sm text-gray-600")})}),(0,d.jsxs)("div",{className:"flex items-center ".concat(c&&!g?"justify-center":"space-x-3"),children:[(0,d.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,d.jsx)("img",{src:o,alt:"Corporaci\xf3n Logo",className:"\n                  ".concat(c&&!g?"w-10 h-10":"w-12 h-12 md:w-14 md:h-14"," \n                  rounded-xl object-cover bg-white p-2 shadow-md transition-all duration-300\n                ")}),(0,d.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 md:w-4 md:h-4 bg-green-500 rounded-full border-2 border-white shadow-sm"})]}),(0,d.jsxs)("div",{className:"".concat(c&&!g?"hidden":"block"," transition-all duration-300"),children:[(0,d.jsx)("h2",{className:"text-base md:text-lg font-Lato font-bold text-gray-800 leading-tight",children:"Corporaci\xf3n"}),(0,d.jsx)("p",{className:"text-xs font-Poppins text-gray-600",children:"Todo por un Alma"})]})]})]}),(0,d.jsx)("nav",{className:"p-3 md:p-4 flex-1 overflow-y-auto",children:(0,d.jsx)("ul",{className:"space-y-1",children:v.map(e=>(0,d.jsx)("li",{children:(0,d.jsxs)(i.N_,{to:e.link,className:"\n                    flex items-center \n                    ".concat(c&&!g?"justify-center px-3":"space-x-3 px-4"," \n                    py-3 md:py-3.5\n                    rounded-xl \n                    hover:bg-gray-100 hover:shadow-sm \n                    transition-all duration-200 \n                    group relative overflow-hidden\n                    min-h-[48px]\n                    ").concat(b.pathname.startsWith(e.link)?"bg-blue-50 text-blue-700 ring-1 ring-blue-100":"","\n                  "),onClick:g?t:void 0,"aria-current":b.pathname.startsWith(e.link)?"page":void 0,children:[(0,d.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-50/50 to-blue-25/30 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),(0,d.jsx)("i",{className:"\n                    ".concat(e.icon," \n                    ").concat(g?"text-xl":"text-lg","\n                    ").concat(b.pathname.startsWith(e.link)?"text-blue-700":"text-gray-600 group-hover:text-blue-600"," \n                    group-hover:scale-110 transition-all flex-shrink-0 relative z-10\n                  ")}),(0,d.jsx)("span",{className:"\n                    font-Poppins font-medium \n                    ".concat(g?"text-base":"text-sm","\n                    ").concat(b.pathname.startsWith(e.link)?"text-blue-800":"text-gray-700 group-hover:text-gray-900"," \n                    ").concat(c&&!g?"hidden":"block","\n                    transition-all duration-300 z-10\n                  "),children:e.label}),e.badge&&!c&&(0,d.jsx)("span",{className:"ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold shadow-sm",children:e.badge})]})},e.id))})}),(0,d.jsxs)("div",{className:"p-3 md:p-4 border-t border-gray-200 mt-auto bg-gradient-to-r from-gray-50 to-gray-100",children:[(0,d.jsxs)("div",{className:"\n            flex items-center \n            ".concat(c&&!g?"justify-center":"space-x-3"," \n            mb-3\n          "),children:[(0,d.jsxs)("div",{className:"relative flex-shrink-0",children:[null!==m&&void 0!==m&&m.photoURL?(0,d.jsx)("img",{src:m.photoURL,alt:"Usuario",className:"\n                    rounded-full border-2 border-gray-300 shadow-md \n                    ".concat(c&&!g?"w-10 h-10":"w-11 h-11 md:w-12 md:h-12","\n                  ")}):(0,d.jsx)("div",{className:"\n                  rounded-full border-2 border-gray-300 shadow-md \n                  bg-gradient-to-br from-blue-100 to-blue-200 \n                  flex items-center justify-center \n                  ".concat(c&&!g?"w-10 h-10":"w-11 h-11 md:w-12 md:h-12","\n                "),children:(0,d.jsx)("i",{className:"fas fa-user text-blue-600 ".concat(g?"text-lg":"text-base")})}),(0,d.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white shadow-sm"})]}),(!c||g)&&(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("p",{className:"text-sm md:text-base font-Poppins font-semibold text-gray-800 truncate",children:(null===m||void 0===m?void 0:m.displayName)||(null===m||void 0===m||null===(a=m.email)||void 0===a?void 0:a.split("@")[0])}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)("p",{className:"text-xs font-Poppins text-gray-600",children:"ADMINISTRADOR"===f?"Administrador":"Consulta"}),"CONSULTA"===f&&(0,d.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-1.5 py-0.5 rounded",title:"Solo lectura",children:(0,d.jsx)("i",{className:"fas fa-eye text-[10px]"})})]})]})]}),(0,d.jsxs)("button",{onClick:async()=>{try{await p(),x.push("/")}catch(e){console.error("Error during logout:",e)}},className:"\n              flex items-center \n              ".concat(c&&!g?"justify-center":""," \n              w-full px-4 py-3\n              text-sm md:text-base\n              text-gray-700 \n              rounded-xl \n              hover:bg-red-50 hover:text-red-600 hover:shadow-sm \n              transition-all duration-200 \n              font-Poppins font-medium \n              group relative overflow-hidden\n              min-h-[48px]\n            "),children:[(0,d.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-red-50/50 to-red-25/30 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),(0,d.jsx)("i",{className:"\n              fas fa-sign-out-alt \n              ".concat(g?"text-lg":"text-base","\n              ").concat(c&&!g?"":"mr-3"," \n              group-hover:scale-110 transition-transform relative z-10\n            ")}),(!c||g)&&(0,d.jsx)("span",{className:"relative z-10",children:"Cerrar Sesi\xf3n"})]})]})]})]})},u=r.memo(e=>{let{title:a="Dashboard",subtitle:s="Bienvenido",extraActions:t=null}=e;const{currentUser:i,logout:c}=(0,n.As)(),u=(0,l.W6)(),{sidebarCollapsed:m}=(0,n.VF)(),[p,x]=(0,r.useState)(!1),g=(0,r.useRef)(null);(0,r.useEffect)(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&x(!1)},a=e=>{"Escape"===e.key&&x(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",a)}},[]);const h=(0,r.useCallback)(async e=>{e&&(e.preventDefault(),e.stopPropagation());try{await c(),x(!1),u.push("/")}catch(e){console.error("Error al cerrar sesi\xf3n",e)}},[u,c]),b=(0,r.useCallback)(async()=>{try{null!==i&&void 0!==i&&i.email&&(await navigator.clipboard.writeText(i.email),x(!1))}catch(e){console.error("No se pudo copiar el correo",e)}},[null===i||void 0===i?void 0:i.email]),f=(0,r.useCallback)(()=>{x(e=>!e)},[]),v=(0,r.useMemo)(()=>m?"md:ml-20":"md:ml-64",[m]),y=(0,r.useMemo)(()=>(null===i||void 0===i?void 0:i.displayName)||(null===i||void 0===i?void 0:i.email),[null===i||void 0===i?void 0:i.displayName,null===i||void 0===i?void 0:i.email]);return(0,d.jsx)("header",{className:"\n      fixed top-0 right-0 left-0 z-40 \n      bg-white/95 backdrop-blur-lg \n      shadow-md border-b border-gray-200\n      transition-all duration-300\n    ",children:(0,d.jsx)("div",{className:"\n        px-4 md:px-6 \n        py-2.5 md:py-3 \n        transition-all duration-300 \n        ".concat(v,"\n      "),children:(0,d.jsxs)("div",{className:"flex items-center justify-between gap-2 md:gap-4",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 md:space-x-3 flex-1 min-w-0 ml-12 md:ml-0",children:[(0,d.jsx)("img",{src:o,alt:"Todo por un Alma",className:"hidden sm:block h-8 md:h-10 w-8 md:w-10 rounded-lg shadow-sm flex-shrink-0"}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("h1",{className:"text-base sm:text-lg md:text-2xl font-Lato font-bold text-gray-800 truncate",children:a}),s&&(0,d.jsx)("p",{className:"hidden md:block text-xs md:text-sm font-Poppins text-gray-600 truncate",children:s})]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 md:space-x-4 flex-shrink-0",children:[t&&(0,d.jsx)("div",{className:"hidden lg:flex items-center space-x-3",children:t}),(0,d.jsxs)("div",{className:"relative",ref:g,children:[(0,d.jsxs)("button",{onClick:f,className:"flex items-center space-x-2 md:space-x-3 bg-gray-100 rounded-full pl-1.5 md:pl-2 pr-2 md:pr-3 py-1 md:py-1.5 hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[44px]","aria-haspopup":"true","aria-expanded":p,children:[(0,d.jsxs)("div",{className:"relative flex-shrink-0",children:[null!==i&&void 0!==i&&i.photoURL?(0,d.jsx)("img",{src:i.photoURL,alt:"Usuario",className:"w-8 h-8 md:w-9 md:h-9 rounded-full border-2 border-blue-500"}):(0,d.jsx)("div",{className:"w-8 h-8 md:w-9 md:h-9 rounded-full border-2 border-blue-500 bg-blue-500 flex items-center justify-center",children:(0,d.jsx)("i",{className:"fas fa-user text-white text-sm"})}),(0,d.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 md:w-3 md:h-3 bg-green-400 rounded-full border-2 border-white"})]}),(0,d.jsx)("span",{className:"hidden sm:block text-sm md:text-base font-Poppins font-medium text-gray-700 max-w-[120px] md:max-w-none truncate",children:y}),(0,d.jsx)("i",{className:"hidden sm:block fas fa-chevron-".concat(p?"up":"down"," text-gray-500 text-xs")})]}),p&&(0,d.jsxs)("div",{className:"absolute right-0 mt-2 w-56 md:w-64 bg-white border border-gray-200 rounded-xl shadow-xl z-50 overflow-hidden",children:[(0,d.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50",children:[(0,d.jsx)("p",{className:"text-xs text-gray-500 font-Poppins",children:"Sesi\xf3n iniciada como"}),(0,d.jsx)("p",{className:"text-sm md:text-base text-gray-800 truncate font-Poppins font-medium mt-0.5",children:null===i||void 0===i?void 0:i.email})]}),(0,d.jsxs)("ul",{className:"py-1",children:[(0,d.jsx)("li",{children:(0,d.jsxs)("button",{onClick:b,className:"w-full flex items-center px-4 py-3 text-sm md:text-base text-gray-700 hover:bg-gray-50 font-Poppins transition-colors min-h-[48px]",children:[(0,d.jsx)("i",{className:"fas fa-copy mr-3 text-gray-500 w-4"}),"Copiar correo"]})}),(0,d.jsx)("li",{children:(0,d.jsxs)("button",{onClick:()=>{u.push("/configuracion"),x(!1)},className:"w-full flex items-center px-4 py-3 text-sm md:text-base text-gray-700 hover:bg-gray-50 font-Poppins transition-colors min-h-[48px]",children:[(0,d.jsx)("i",{className:"fas fa-cog mr-3 text-gray-500 w-4"}),"Configuraci\xf3n"]})}),(0,d.jsx)("li",{className:"border-t border-gray-100",children:(0,d.jsxs)("button",{onClick:h,className:"w-full flex items-center px-4 py-3 text-sm md:text-base text-red-600 hover:bg-red-50 font-Poppins transition-colors min-h-[48px]",children:[(0,d.jsx)("i",{className:"fas fa-sign-out-alt mr-3 w-4"}),"Cerrar sesi\xf3n"]})})]})]})]})]})]})})})});var m=s(6761);const p=e=>{let{title:a="Dashboard",subtitle:s="",children:t,loading:r=!1,loadingText:l="Cargando...",extraActions:i=null}=e;const{sidebarOpen:o,sidebarCollapsed:p,toggleSidebarOpen:x,toggleSidebarCollapsed:g}=(0,n.VF)(),h=p?"md:ml-20":"md:ml-64";return r?(0,d.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:(0,d.jsxs)("div",{className:"flex",children:[(0,d.jsx)(c,{isOpen:o,onToggle:x,isCollapsed:p,onToggleCollapse:g}),(0,d.jsx)("main",{className:"flex-1 transition-all duration-300 ".concat(h," pt-16 md:pt-20 px-4 md:px-0"),children:(0,d.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,d.jsx)(m.A,{size:"xl",text:l})})})]})}):(0,d.jsx)("div",{className:"min-h-screen bg-gray-50 font-sans antialiased",children:(0,d.jsxs)("div",{className:"flex",children:[(0,d.jsx)(c,{isOpen:o,onToggle:x,isCollapsed:p,onToggleCollapse:g}),(0,d.jsxs)("main",{className:"flex-1 transition-all duration-300 ".concat(h," pt-16 md:pt-20 px-4 md:px-0"),children:[(0,d.jsx)(u,{title:a,subtitle:s,extraActions:i}),t]})]})})},x=e=>(0,d.jsx)(n.GB,{children:(0,d.jsx)(p,(0,t.A)({},e))})},4349:(e,a,s)=>{s.d(a,{C5:()=>r.C5,FH:()=>t.FH,gg:()=>r.gg});var t=s(493),r=s(5848);s(6752),s(7479)},6938:(e,a,s)=>{s.d(a,{BZ:()=>n,DT:()=>l,F2:()=>m,Hc:()=>d,Ri:()=>r,Wk:()=>u,Zi:()=>o,ju:()=>c});var t=s(4349);const r=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!e||!e.trim())return{isValid:!1,error:"El n\xfamero de documento es requerido"};const s=await t.C5.getParticipantes();if(s.data&&Array.isArray(s.data)){if(s.data.some(s=>{const t=s.id||s.id_participante;return s.numero_documento===e&&t!==a}))return{isValid:!1,error:"El n\xfamero de documento ya est\xe1 registrado para otro participante"}}return{isValid:!0,error:null}}catch(s){return console.error("Error validating participante documento:",s),{isValid:!0,error:null}}},n=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!e||!e.trim())return{isValid:!1,error:"El n\xfamero de documento es requerido"};const s=await t.C5.getAcudientes();if(s.data&&Array.isArray(s.data)){if(s.data.some(s=>{const t=s.id||s.id_acudiente;return s.numero_documento===e&&t!==a}))return{isValid:!1,error:"El n\xfamero de documento ya est\xe1 registrado para otro acudiente"}}return{isValid:!0,error:null}}catch(s){return console.error("Error validating acudiente documento:",s),{isValid:!0,error:null}}},l=e=>{if(!e||!e.trim())return{isValid:!1,error:"El email es requerido"};return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?{isValid:!0,error:null}:{isValid:!1,error:"El formato del email no es v\xe1lido"}},i=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fecha";if(!e)return{isValid:!1,error:"La ".concat(a," es requerida")};const s=new Date(e),t=new Date;return t.setHours(23,59,59,999),s instanceof Date&&!isNaN(s.getTime())?s>t?{isValid:!1,error:"La ".concat(a," no puede ser futura")}:{isValid:!0,error:null}:{isValid:!1,error:"La ".concat(a," no es v\xe1lida")}},o=e=>i(e,"fecha de nacimiento"),d=e=>i(e,"fecha de ingreso"),c=async e=>{try{if(!e)return{isValid:!1,error:"Debe seleccionar un participante"};const a=await t.C5.getParticipantes();if(a.data&&Array.isArray(a.data)){if(!a.data.some(a=>(a.id_participante||a.id)===parseInt(e)))return{isValid:!1,error:"El participante seleccionado no existe"}}return{isValid:!0,error:null}}catch(a){return console.error("Error validating participante exists:",a),{isValid:!1,error:"Error al validar el participante"}}},u=async e=>{try{if(!e)return{isValid:!1,error:"Debe seleccionar una sede"};const a=await t.C5.getSedes();if(a.data&&Array.isArray(a.data)){if(!a.data.some(a=>(a.id_sede||a.id)===parseInt(e)))return{isValid:!1,error:"La sede seleccionada no existe"}}return{isValid:!0,error:null}}catch(a){return console.error("Error validating sede exists:",a),{isValid:!1,error:"Error al validar la sede"}}},m=async(e,a)=>{const s=await c(e);if(!s.isValid)return s;const r=await(async e=>{try{if(!e)return{isValid:!1,error:"Debe seleccionar un acudiente"};const a=await t.C5.getAcudientes();return a.data&&Array.isArray(a.data)&&!a.data.some(a=>(a.id_acudiente||a.id)===parseInt(e))?{isValid:!1,error:"El acudiente seleccionado no existe"}:{isValid:!0,error:null}}catch(a){return console.error("Error validating acudiente exists:",a),{isValid:!1,error:"Error al validar el acudiente"}}})(a);return r.isValid?{isValid:!0,error:null}:r}},6954:(e,a,s)=>{s.r(a),s.d(a,{default:()=>m});var t=s(9379),r=s(5043),n=s(3474),l=s(4349),i=s(3714),o=s(8368),d=s(6938),c=s(579);const u=e=>{let{value:a,onChange:s,label:t="Per\xedodo"}=e;const n=(0,r.useMemo)(()=>[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],[]),l=(0,r.useMemo)(()=>Array.from({length:11},(e,a)=>2020+a),[]),i=(0,r.useMemo)(()=>{const e=[{value:"all",label:"Todos"}];return l.forEach(a=>{n.forEach(s=>{e.push({value:"".concat(s.value,"-").concat(a),label:"".concat(s.label," ").concat(a)})})}),e},[n,l]);return(0,c.jsxs)("div",{className:"w-full",children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,c.jsx)("select",{value:a,onChange:e=>s(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:i.map(e=>(0,c.jsx)("option",{value:e.value,children:e.label},e.value))})]})},m=r.memo(()=>{const[e,a]=(0,r.useState)([]),[s,m]=(0,r.useState)([]),[p,x]=(0,r.useState)([]),[g,h]=(0,r.useState)([]),[b,f]=(0,r.useState)([]),[v,y]=(0,r.useState)(null),[N,j]=(0,r.useState)(!0),[A,w]=(0,r.useState)({participant_id:"",id_acudiente:"",mes:"","a\xf1o":(new Date).getFullYear(),valor:"",status:"PAGADA",metodo_pago:"TRANSFERENCIA",fecha_pago:"",observaciones:""}),{filters:C,setFilter:_,clearFilters:E}=(0,i.R7)({periodo:"all",sede:"all",estado:"all",busqueda:""}),{isOpen:k,openModal:P,closeModal:S,modalData:D,updateModalData:T}=(0,i.hS)(),I=(0,r.useCallback)((e,a)=>{w(s=>(0,t.A)((0,t.A)({},s),{},{[e]:a}))},[]),M=(0,r.useMemo)(()=>[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],[]),R=(0,r.useMemo)(()=>Array.from({length:11},(e,a)=>2020+a),[]),V=(0,r.useCallback)(e=>{const a=M.find(a=>a.value===e);return a?a.label:e.toString()},[M]);(0,r.useEffect)(()=>{(async()=>{try{j(!0),y(null),console.log("\ud83d\udd04 Cargando datos financieros...");const[e,s,t,r]=await Promise.all([l.C5.getMensualidades(),l.C5.getParticipantes(),l.C5.getSedes(),l.C5.getAcudientes()]);console.log("\ud83d\udcca Resultados:",{mensRes:e,partsRes:s,sedesRes:t,acudRes:r});const n=Array.isArray(e.data)?e.data:[],i=Array.isArray(s.data)?s.data:[],o=Array.isArray(t.data)?t.data:[],d=Array.isArray(r.data)?r.data:[];a(n),m(i),x(o),h(d),f(d),console.log("\u2705 Datos cargados:",{mensualidades:n.length,participantes:i.length,sedes:o.length,acudientes:d.length})}catch(e){console.error("\u274c Error cargando datos financieros:",e),y(e.message||"Error desconocido al cargar datos"),a([]),m([]),x([]),h([])}finally{j(!1)}})()},[]),(0,r.useEffect)(()=>{if(A.participant_id){const e=g.filter(e=>e.id_participante===parseInt(A.participant_id));f(e),A.id_acudiente&&!e.find(e=>e.id_acudiente===parseInt(A.id_acudiente))&&w(e=>(0,t.A)((0,t.A)({},e),{},{id_acudiente:""}))}else f(g)},[A.participant_id,g,A.id_acudiente]);const O=(0,r.useMemo)(()=>{let a=Array.isArray(e)?e:[];if("all"!==C.periodo){const[e,s]=C.periodo.split("-").map(Number);a=a.filter(a=>a.mes===e&&a.a\u00f1o===s)}return"all"!==C.sede&&(a=a.filter(e=>e.sede_id===parseInt(C.sede))),"all"!==C.estado&&(a=a.filter(e=>e.estado===C.estado)),C.busqueda&&(a=a.filter(e=>(e.participant_documento||"").includes(C.busqueda)||(e.acudiente_documento||"").includes(C.busqueda))),a},[e,C]),{currentPage:F,totalPages:L,paginatedData:q,setPage:U}=(0,i.WQ)(O,10),z=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(w({participant_id:e.participante_id||e.participant_id,id_acudiente:e.id_acudiente||"",mes:e.mes,"a\xf1o":e.a\u00f1o,valor:e.valor||e.monto,status:e.estado||e.status,metodo_pago:e.metodo_pago||"TRANSFERENCIA",fecha_pago:e.fecha_pago||"",observaciones:e.observaciones||""}),T(e)):(w({participant_id:"",id_acudiente:"",mes:"","a\xf1o":(new Date).getFullYear(),valor:"",status:"PAGADA",metodo_pago:"TRANSFERENCIA",fecha_pago:"",observaciones:""}),T(null)),P()},[P,T]),G=(0,r.useCallback)(async(e,s)=>{try{await l.C5.updateMensualidad(e,{estado:s});const{data:t}=await l.C5.getMensualidades();a(t||[])}catch(t){console.error("Error updating status:",t)}},[]),W=(0,r.useCallback)(async e=>{if(e.preventDefault(),"PAGADA"===A.status&&!A.fecha_pago)return void alert("La fecha de pago es requerida cuando el estado es PAGADA");try{if(A.id_acudiente){const e=await(0,d.F2)(parseInt(A.participant_id),parseInt(A.id_acudiente));if(!e.isValid)return void alert(e.error)}}catch(t){return console.error("Error validating relations:",t),void alert("Error al validar las relaciones: "+(t.message||"Error desconocido"))}const s={participant_id:parseInt(A.participant_id),id_acudiente:A.id_acudiente?parseInt(A.id_acudiente):null,mes:parseInt(A.mes),"a\xf1o":parseInt(A.a\u00f1o),monto:parseFloat(A.valor),estado:A.status,metodo_pago:A.metodo_pago,fecha_pago:"PAGADA"===A.status?A.fecha_pago:null,observaciones:A.observaciones||null};try{null!==D&&void 0!==D&&D.id?await l.C5.updateMensualidad(D.id,s):await l.C5.createMensualidad(s),S();const{data:e}=await l.C5.getMensualidades();a(e||[])}catch(t){console.error("Error saving payment:",t),alert("Error al guardar la mensualidad: "+(t.message||"Error desconocido"))}},[A,D,S]);return N?(0,c.jsx)(n.A,{title:"Mensualidades",subtitle:"Cargando mensualidades...",loading:!0,children:(0,c.jsx)(o.kt,{})}):v?(0,c.jsx)(n.A,{title:"Mensualidades",subtitle:"Error al cargar datos",loading:!1,children:(0,c.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,c.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,c.jsxs)("p",{className:"text-red-600",children:["Error loading payments: ",v]})})})}):(0,c.jsxs)(n.A,{title:"Mensualidades",subtitle:"Pagadas, pendientes y vencidas",extraActions:(0,c.jsxs)("button",{onClick:()=>z(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,c.jsx)("i",{className:"fas fa-plus mr-2"}),"Nueva Mensualidad"]}),children:[(0,c.jsxs)("section",{className:"px-4 md:px-6 py-4 md:py-6",children:[(0,c.jsx)(o.Qn,{filters:[{type:"custom",name:"periodo",component:u,props:{label:"Per\xedodo"}},{type:"select",name:"sede",label:"Sede",placeholder:"Todas",options:[{value:"all",label:"Todas"},...p.map(e=>({value:e.id.toString(),label:e.nombre}))]},{type:"select",name:"estado",label:"Estado",placeholder:"Todos",options:[{value:"all",label:"Todos"},{value:"PAGADA",label:"Pagada"},{value:"PENDIENTE",label:"Pendiente"}]},{type:"search",name:"busqueda",label:"B\xfasqueda por Documento",placeholder:"N\xfamero de documento..."}],values:C,onChange:_,onClear:E,showClearButton:!0}),(0,c.jsxs)("div",{className:"mt-6",children:[(0,c.jsx)(o.bQ,{data:q,columns:[{key:"participant_name",header:"Participante",render:e=>(0,c.jsx)("span",{className:"font-medium text-gray-900",children:e.participant_name})},{key:"acudiente_name",header:"Acudiente",render:e=>(0,c.jsx)("span",{className:"text-gray-700",children:e.acudiente_name||"N/A"})},{key:"mes",header:"Mes",render:e=>V(e.mes)},{key:"valor",header:"Cantidad",render:e=>"$".concat((e.valor||e.monto||0).toLocaleString())},{key:"metodo_pago",header:"M\xe9todo de Pago",render:e=>(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"TRANSFERENCIA"===e.metodo_pago?"Transferencia":"EFECTIVO"===e.metodo_pago?"Efectivo":"N/A"})},{key:"status",header:"Estado",render:e=>(0,c.jsx)(o.re,{currentStatus:e.status||e.estado,statuses:[{value:"PAGADA",label:"PAGADA",variant:"success"},{value:"PENDIENTE",label:"PENDIENTE",variant:"danger"}],onChange:a=>G(e.id,a)})},{key:"observaciones",header:"Observaciones",render:e=>(0,c.jsx)("span",{className:"text-sm text-gray-600 truncate max-w-xs block",title:e.observaciones||"",children:e.observaciones?e.observaciones.length>30?e.observaciones.substring(0,30)+"...":e.observaciones:"-"})},{key:"actions",header:"Acciones",render:e=>(0,c.jsx)(o.yd,{actions:[{label:"Ver",icon:"fas fa-eye",onClick:()=>z(e)},{label:"Editar",icon:"fas fa-edit",onClick:()=>z(e)}]})}],keyExtractor:e=>e.id,loading:N,emptyState:(0,c.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No hay mensualidades que mostrar"})}),L>1&&(0,c.jsx)(o.dK,{currentPage:F,totalPages:L,onPageChange:U,itemsPerPage:10,totalItems:O.length,showInfo:!0,className:"mt-4"})]})]}),(0,c.jsx)(o.k5,{isOpen:k,onClose:S,title:D?"Ver/Editar Mensualidad":"Nueva Mensualidad",onSubmit:W,submitLabel:"Guardar",size:"lg",children:(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)(o.FX,{label:"Participante",name:"participant_id",value:A.participant_id,onChange:e=>I("participant_id",e),options:s.map(e=>({value:e.id,label:"".concat(e.nombres," ").concat(e.apellidos," - ").concat(e.documento)})),placeholder:"Seleccionar Participante",required:!0}),(0,c.jsx)(o.FX,{label:"Acudiente",name:"id_acudiente",value:A.id_acudiente,onChange:e=>I("id_acudiente",e),options:b.map(e=>({value:e.id_acudiente||e.id,label:"".concat(e.nombres," ").concat(e.apellidos," - ").concat(e.parentesco)})),placeholder:"Seleccionar Acudiente",disabled:!A.participant_id}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsx)(o.FX,{label:"Mes",name:"mes",value:A.mes,onChange:e=>I("mes",e),options:M.map(e=>({value:e.value,label:e.label})),placeholder:"Seleccionar Mes",required:!0}),(0,c.jsx)(o.FX,{label:"A\xf1o",name:"a\xf1o",value:A.a\u00f1o,onChange:e=>I("a\xf1o",e),options:R.map(e=>({value:e,label:e.toString()})),required:!0})]}),(0,c.jsx)(o.ZQ,{label:"Valor",name:"valor",type:"number",value:A.valor,onChange:e=>I("valor",e),placeholder:"Valor",required:!0}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsx)(o.FX,{label:"Estado",name:"status",value:A.status,onChange:e=>I("status",e),options:[{value:"PAGADA",label:"Pagada"},{value:"PENDIENTE",label:"Pendiente"}],required:!0}),(0,c.jsx)(o.FX,{label:"M\xe9todo de Pago",name:"metodo_pago",value:A.metodo_pago,onChange:e=>I("metodo_pago",e),options:[{value:"TRANSFERENCIA",label:"Transferencia"},{value:"EFECTIVO",label:"Efectivo"}],required:!0})]}),"PAGADA"===A.status&&(0,c.jsx)(o.ZQ,{label:"Fecha de Pago",name:"fecha_pago",type:"date",value:A.fecha_pago,onChange:e=>I("fecha_pago",e),required:"PAGADA"===A.status}),(0,c.jsx)(o.hg,{label:"Observaciones",name:"observaciones",value:A.observaciones,onChange:e=>I("observaciones",e),placeholder:"Observaciones adicionales...",rows:3}),D&&(0,c.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,c.jsx)("h4",{className:"font-semibold text-gray-700 mb-2",children:"Informaci\xf3n Completa"}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-600",children:"Participante:"}),(0,c.jsx)("span",{className:"ml-2 font-medium",children:D.participant_name})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-600",children:"Acudiente:"}),(0,c.jsx)("span",{className:"ml-2 font-medium",children:D.acudiente_name||"N/A"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-600",children:"M\xe9todo de Pago:"}),(0,c.jsx)("span",{className:"ml-2 font-medium",children:"TRANSFERENCIA"===D.metodo_pago?"Transferencia":"EFECTIVO"===D.metodo_pago?"Efectivo":"N/A"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-gray-600",children:"Fecha de Pago:"}),(0,c.jsx)("span",{className:"ml-2 font-medium",children:D.fecha_pago?new Date(D.fecha_pago).toLocaleDateString():"N/A"})]}),D.observaciones&&(0,c.jsxs)("div",{className:"col-span-2",children:[(0,c.jsx)("span",{className:"text-gray-600",children:"Observaciones:"}),(0,c.jsx)("p",{className:"ml-2 mt-1 text-gray-700",children:D.observaciones})]})]})]})]})})]})})}}]);
//# sourceMappingURL=954.feeb2cb8.chunk.js.map