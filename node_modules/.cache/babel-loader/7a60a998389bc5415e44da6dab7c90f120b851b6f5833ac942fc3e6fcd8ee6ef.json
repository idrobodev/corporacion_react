{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState,useMemo,useCallback}from\"react\";import{api}from\"../services/api\";// Single context for simplicity and reliability\nimport{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(undefined);// Main hook to access auth context\nexport const useAuth=()=>{const context=useContext(AuthContext);if(context===undefined){throw new Error('useAuth must be used within an AuthProvider');}return context;};// Provider\nconst AuthProvider=_ref=>{let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const initializeAuth=()=>{setLoading(true);try{const storedUser=localStorage.getItem('currentUser');const storedToken=localStorage.getItem('authToken');if(storedUser&&storedToken){try{const user=JSON.parse(storedUser);if(user&&user.email&&(user.id||user.userId)){setCurrentUser(user);}else{setCurrentUser(null);localStorage.removeItem('authToken');localStorage.removeItem('currentUser');}}catch(parseError){console.error('Error parseando usuario:',parseError);setCurrentUser(null);localStorage.removeItem('authToken');localStorage.removeItem('currentUser');}}else{setCurrentUser(null);}}catch(error){console.error('Error inicializando auth:',error);setCurrentUser(null);}finally{setLoading(false);}};initializeAuth();},[]);const login=useCallback(async(email,password)=>{console.log('ðŸš€ AuthContext: Starting login process...');console.log('ðŸ‘¤ Attempting login for email:',email);try{console.log('ðŸ”— Calling api.login...');const{data,error}=await api.login(email,password);if(error){console.error('âŒ API login returned error:',error);throw error;}console.log('âœ… API login successful, user:',data.user.email);console.log('ðŸ”„ Setting current user in context...');setCurrentUser(data.user);console.log('ðŸŽ¯ AuthContext login completed successfully');return{user:data.user};}catch(error){console.error('ðŸ’¥ AuthContext login failed:',error);console.error('ðŸ“‹ Error type:',error.type||'unknown');console.error('ðŸŒ Is network error:',error.isNetworkError);console.error('ðŸ”’ Is CORS error:',error.isCorsError);throw error;}},[]);const logout=useCallback(async()=>{try{setCurrentUser(null);localStorage.removeItem('authToken');localStorage.removeItem('currentUser');try{await api.logout();}catch(logoutError){console.warn('Error notificando logout al servidor:',logoutError);}return{success:true};}catch(error){console.error('Error durante logout:',error);setCurrentUser(null);localStorage.removeItem('authToken');localStorage.removeItem('currentUser');throw error;}},[]);const forgetPassword=useCallback(async email=>{const{error}=await api.resetPassword(email);if(error)throw error;return{success:true};},[]);const value=useMemo(()=>({currentUser,loading,login,logout,forgetPassword}),[currentUser,loading,login,logout,forgetPassword]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export default AuthProvider;","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useMemo","useCallback","api","jsx","_jsx","AuthContext","undefined","useAuth","context","Error","AuthProvider","_ref","children","currentUser","setCurrentUser","loading","setLoading","initializeAuth","storedUser","localStorage","getItem","storedToken","user","JSON","parse","email","id","userId","removeItem","parseError","console","error","login","password","log","data","type","isNetworkError","isCorsError","logout","logoutError","warn","success","forgetPassword","resetPassword","value","Provider"],"sources":["/Users/todoporunalma/Desktop/Corporacion/coptua_react/src/shared/contexts/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useMemo, useCallback } from \"react\";\nimport { api } from \"../services/api\";\n\n// Single context for simplicity and reliability\nconst AuthContext = createContext(undefined);\n\n// Main hook to access auth context\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\n// Provider\n\nconst AuthProvider = ({ children }) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const initializeAuth = () => {\n      setLoading(true);\n      try {\n        const storedUser = localStorage.getItem('currentUser');\n        const storedToken = localStorage.getItem('authToken');\n        \n        if (storedUser && storedToken) {\n          try {\n            const user = JSON.parse(storedUser);\n            \n            if (user && user.email && (user.id || user.userId)) {\n              setCurrentUser(user);\n            } else {\n              setCurrentUser(null);\n              localStorage.removeItem('authToken');\n              localStorage.removeItem('currentUser');\n            }\n          } catch (parseError) {\n            console.error('Error parseando usuario:', parseError);\n            setCurrentUser(null);\n            localStorage.removeItem('authToken');\n            localStorage.removeItem('currentUser');\n          }\n        } else {\n          setCurrentUser(null);\n        }\n      } catch (error) {\n        console.error('Error inicializando auth:', error);\n        setCurrentUser(null);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    initializeAuth();\n  }, []);\n\n\n  const login = useCallback(async (email, password) => {\n    console.log('ðŸš€ AuthContext: Starting login process...');\n    console.log('ðŸ‘¤ Attempting login for email:', email);\n\n    try {\n      console.log('ðŸ”— Calling api.login...');\n      const { data, error } = await api.login(email, password);\n\n      if (error) {\n        console.error('âŒ API login returned error:', error);\n        throw error;\n      }\n\n      console.log('âœ… API login successful, user:', data.user.email);\n      console.log('ðŸ”„ Setting current user in context...');\n      setCurrentUser(data.user);\n      console.log('ðŸŽ¯ AuthContext login completed successfully');\n      return { user: data.user };\n    } catch (error) {\n      console.error('ðŸ’¥ AuthContext login failed:', error);\n      console.error('ðŸ“‹ Error type:', error.type || 'unknown');\n      console.error('ðŸŒ Is network error:', error.isNetworkError);\n      console.error('ðŸ”’ Is CORS error:', error.isCorsError);\n      throw error;\n    }\n  }, []);\n\n  const logout = useCallback(async () => {\n    try {\n      setCurrentUser(null);\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('currentUser');\n      \n      try {\n        await api.logout();\n      } catch (logoutError) {\n        console.warn('Error notificando logout al servidor:', logoutError);\n      }\n      \n      return { success: true };\n    } catch (error) {\n      console.error('Error durante logout:', error);\n      setCurrentUser(null);\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('currentUser');\n      throw error;\n    }\n  }, []);\n\n  const forgetPassword = useCallback(async (email) => {\n    const { error } = await api.resetPassword(email);\n    if (error) throw error;\n    return { success: true };\n  }, []);\n  const value = useMemo(() => ({\n    currentUser,\n    loading,\n    login,\n    logout,\n    forgetPassword,\n  }), [currentUser, loading, login, logout, forgetPassword]);\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthProvider;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}